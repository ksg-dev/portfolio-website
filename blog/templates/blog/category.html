<!----
 * AURA Portfolio - Category Template - UPDATED WITH HEXAGON COMPONENT
 * Advanced User Repository & Archive - Complete Foundation
 * Version: 3.0.0 - Now using reusable hexagon navigation component
 NOTE TO SELF: Still has inline scripts, review
---->

{% extends "blog/datalogs_base.html" %}
{% load static %}
{% load aura_filters %}
{% load aura_components %}
{% load datalog_tags %}

{% block title %}{{ category.name }} Category | DataLogs | AURA{% endblock %}
{% block meta_description %}Browse Log entries in {{ category.name|upper }} category - {{ posts|length }} development insights and technical documentation.{% endblock %}

{% block datalogs_css %}
<link rel="stylesheet" href="{% static 'blog/css/datalogs_consolidated.css' %}">
{% endblock %}

{% block datalogs_body_class %}category-view{% endblock %}

{% block datalogs_title %}[ CATEGORY: {{ category.name|upper }} ]{% endblock %}
{% block datalogs_subtitle %}
    {{ posts|length|format_number }} {{ category.name }} entries
    {% if posts %}
    | {% calculate 'multiply' posts.0.reading_time posts|length as total_reading %}{{ total_reading|format_duration }} total reading
    {% endif %}
{% endblock %}

{% block datalogs_breadcrumbs %}
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item active">{{ category.name }}</span>
{% endblock %}

{% block datalogs_content %}

<!-- Category Header Section -->
<section class="category-header-section">
    <div class="glass-card category-display-card">
        <div class="category-hero-display">
            <!-- Large Category Hexagon -->
            <div class="category-hero-hexagon">
                {% category_hexagon_single category size="xl" show_label=False link=False %}
            </div>
            
            <!-- Category Information -->
            <div class="category-hero-info">
                <h2 class="category-display-name">{{ category.name }}</h2>
                {% if category.description %}
                <p class="category-display-description">{{ category.description }}</p>
                {% endif %}
                
                <!-- Category Statistics -->
                <div class="category-stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-file-alt"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">{{ posts|length|format_number }}</div>
                            <div class="stat-label">Entries</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                        <div class="stat-content">
                            {% calculate 'multiply' posts.0.reading_time|default:3 posts|length as total_reading %}
                            <div class="stat-value">{{ total_reading|format_duration }}</div>
                            <div class="stat-label">Total Reading</div>
                        </div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-calendar"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">{{ posts.0.published_date|time_since_published|default:"Recently" }}</div>
                            <div class="stat-label">Latest Entry</div>
                        </div>
                    </div>
                    
                    {% if category.posts.count > posts|length %}
                    <div class="stat-item">
                        <div class="stat-icon"><i class="fas fa-archive"></i></div>
                        <div class="stat-content">
                            <div class="stat-value">{{ category.posts.count|add:posts|length|mul:"-1"|format_number }}</div>
                            <div class="stat-label">Archived</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Enhanced Search for Category -->
        <div class="category-search-section">
            {% include 'blog/includes/enhanced_search_interface.html' with style='inline' query=query %}
        </div>
    </div>
</section>

<!-- Category Navigation -->
<section class="category-navigation-section">
    {% category_hexagon_nav style="compact" current_category=category %}
</section>

<!-- Category Posts Grid -->
<section class="category-posts-section">
    {% if posts %}
    
    <!-- Grid Header -->
    <div class="category-grid-header">
        <div class="grid-info">
            <h3 class="grid-title">
                <i class="fas fa-list"></i>
                {{ category.name }} DataLog Entries
            </h3>
            <div class="grid-stats">
                <span class="grid-count">{{ posts|length }} of {{ category.posts.count }} entries</span>
                {% if posts %}
                <span class="grid-separator">â€¢</span>
                <span class="grid-reading">{{ total_reading|format_duration }} total reading time</span>
                {% endif %}
            </div>
        </div>
        
        <!-- View Controls -->
        <div class="category-view-controls">
            <div class="sort-controls">
                <select class="hud-select" id="categorySort">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title">Title A-Z</option>
                    <option value="reading-time">Reading Time</option>
                </select>
            </div>
            
            <div class="view-toggle">
                <button class="view-btn active" data-view="grid" title="Grid View">
                    <i class="fas fa-th"></i>
                </button>
                <button class="view-btn" data-view="list" title="List View">
                    <i class="fas fa-list"></i>
                </button>
                <button class="view-btn" data-view="timeline" title="Timeline View">
                    <i class="fas fa-stream"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Posts Grid -->
    <div class="category-posts-grid" id="categoryPostsGrid">
        {% for post in posts %}
        {% render_post_card post show_excerpt=True card_type="category" %}
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if is_paginated %}
    <div class="pagination-container">
        {% render_pagination page_obj request %}
    </div>
    {% endif %}
    
    {% else %}
    <!-- No Posts in Category -->
    <div class="glass-card no-posts-panel">
        <div class="no-posts-content">
            <div class="no-posts-icon">
                {% category_hexagon_single category size="lg" show_label=False link=False %}
            </div>
            <h3 class="no-posts-title">No Entries in {{ category.name }}</h3>
            <p class="no-posts-message">
                There are currently no published entries in the {{ category.name }} category.
                Check back later for new content, or explore other categories.
            </p>
            <div class="no-posts-actions">
                <a href="{% url 'blog:post_list' %}" class="btn btn-primary">
                    <i class="fas fa-list"></i>
                    View All DataLogs
                </a>
                <a href="{% url 'blog:archive' %}" class="btn btn-outline">
                    <i class="fas fa-calendar"></i>
                    Browse Archive
                </a>
            </div>
        </div>
    </div>
    {% endif %}
</section>

<!-- Related Categories Suggestion -->
{% get_datalog_categories as all_categories %}
{% if all_categories|length > 1 %}
<section class="related-categories-section">
    <div class="glass-card related-categories-panel">
        <h3 class="related-title">
            <i class="fas fa-sitemap"></i>
            Explore Other Categories
        </h3>
        
        <div class="related-categories-grid">
            {% for related_category in all_categories %}
            {% if related_category.slug != category.slug %}
            <a href="{% url 'blog:category' slug=related_category.slug %}" class="related-category-card">
                <div class="related-category-hexagon">
                    {% category_hexagon_single related_category size="md" show_label=False %}
                </div>
                <div class="related-category-info">
                    <h4 class="related-category-name">{{ related_category.name }}</h4>
                    <span class="related-category-count">{{ related_category.post_count }} entries</span>
                    {% if related_category.description %}
                    <p class="related-category-desc">{{ related_category.description|truncate_smart:60 }}</p>
                    {% endif %}
                </div>
                <div class="related-category-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% endblock %}

{% block datalogs_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initCategoryView();
    initCategoryViewControls();
    
    console.log('ðŸ“‚ Category view initialized');
});

function initCategoryView() {
    // Initialize hexagon navigation
    if (typeof initCategoryHexagonNav === 'function') {
        initCategoryHexagonNav();
    }
    
    // Category-specific animations
    const categoryCards = document.querySelectorAll('.datalog-card');
    categoryCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Enhanced hover effects for related categories
    const relatedCards = document.querySelectorAll('.related-category-card');
    relatedCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
            
            const hexagon = this.querySelector('.category-hexagon');
            if (hexagon) {
                hexagon.style.transform = 'scale(1.1)';
            }
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
            
            const hexagon = this.querySelector('.category-hexagon');
            if (hexagon) {
                hexagon.style.transform = 'scale(1)';
            }
        });
    });
}

function initCategoryViewControls() {
    // View toggle functionality
    const viewButtons = document.querySelectorAll('.view-btn');
    const postsGrid = document.getElementById('categoryPostsGrid');
    
    viewButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            viewButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const viewType = this.dataset.view;
            updateCategoryView(viewType);
            
            // Store preference
            localStorage.setItem('categoryViewMode', viewType);
        });
    });
    
    // Restore saved view
    const savedView = localStorage.getItem('categoryViewMode');
    if (savedView) {
        const targetBtn = document.querySelector(`[data-view="${savedView}"]`);
        if (targetBtn) {
            targetBtn.click();
        }
    }
    
    // Sort functionality
    const sortSelect = document.getElementById('categorySort');
    if (sortSelect) {
        sortSelect.addEventListener('change', function() {
            const sortValue = this.value;
            console.log('Sorting category posts by:', sortValue);
            
            // Add loading state
            if (postsGrid) {
                postsGrid.style.opacity = '0.6';
                postsGrid.style.pointerEvents = 'none';
                
                setTimeout(() => {
                    postsGrid.style.opacity = '1';
                    postsGrid.style.pointerEvents = 'auto';
                }, 500);
            }
        });
    }
}

function updateCategoryView(viewType) {
    const postsGrid = document.getElementById('categoryPostsGrid');
    if (!postsGrid) return;
    
    // Add loading state
    postsGrid.style.opacity = '0.7';
    postsGrid.style.transform = 'scale(0.98)';
    
    // Update grid class
    setTimeout(() => {
        postsGrid.className = `category-posts-grid view-${viewType}`;
        
        // Restore normal state
        postsGrid.style.opacity = '1';
        postsGrid.style.transform = 'scale(1)';
        
        // Re-initialize animations for new view
        const cards = postsGrid.querySelectorAll('.datalog-card');
        cards.forEach((card, index) => {
            card.style.transition = 'none';
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'opacity 0.4s ease, transform 0.4s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 50);
        });
    }, 200);
}
</script>

<style>
/* Category Template Specific Styles */
.category-header-section {
    margin-bottom: var(--spacing-xl);
}

.category-display-card {
    padding: var(--spacing-xxl);
}

.category-hero-display {
    display: flex;
    align-items: center;
    gap: var(--spacing-xxl);
    margin-bottom: var(--spacing-xl);
}

.category-hero-hexagon {
    flex-shrink: 0;
}

.category-hero-info {
    flex: 1;
}

.category-display-name {
    font-family: var(--font-display);
    font-size: 2.5rem;
    font-weight: 200;
    letter-spacing: 0.1em;
    background: linear-gradient(135deg, var(--color-lavender), var(--color-coral));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    margin-bottom: var(--spacing-sm);
    line-height: 1.2;
}

.category-display-description {
    font-size: 1.1rem;
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: var(--spacing-lg);
    max-width: 600px;
}

.category-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--spacing-lg);
}

.category-search-section {
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    padding-top: var(--spacing-lg);
}

.category-navigation-section {
    margin-bottom: var(--spacing-xl);
}

.category-grid-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.grid-info {
    flex: 1;
}

.grid-title {
    font-family: var(--font-heading);
    font-size: 1.3rem;
    color: var(--color-lavender);
    margin-bottom: var(--spacing-sm);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.grid-stats {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.9rem;
    color: var(--color-text-secondary);
}

.grid-separator {
    color: var(--color-text-tertiary);
    opacity: 0.6;
}

.category-view-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
}

.sort-controls {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.hud-select {
    background: 
        var(--gradient-glass),
        rgba(7, 7, 18, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--border-radius-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--color-text);
    font-family: var(--font-body);
    font-size: 0.9rem;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23b39ddb' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right var(--spacing-sm) center;
    background-size: 12px;
    backdrop-filter: blur(10px);
    min-width: 150px;
}

.hud-select:focus {
    outline: none;
    border-color: var(--color-lavender);
    box-shadow: 0 0 0 2px rgba(179, 157, 219, 0.2);
}

.view-toggle {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.view-btn {
    width: 36px;
    height: 36px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius-sm);
    color: var(--color-text-tertiary);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.view-btn:hover {
    background: rgba(179, 157, 219, 0.1);
    border-color: rgba(179, 157, 219, 0.3);
    color: var(--color-lavender);
}

.view-btn.active {
    background: rgba(179, 157, 219, 0.2);
    border-color: rgba(179, 157, 219, 0.4);
    color: var(--color-lavender);
}

.category-posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--spacing-xl);
    transition: all var(--transition-normal);
}

.category-posts-grid.view-list {
    grid-template-columns: 1fr;
    gap: var(--spacing-lg);
}

.category-posts-grid.view-timeline {
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
    position: relative;
    padding-left: var(--spacing-xl);
}

.category-posts-grid.view-timeline::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--gradient-primary);
    opacity: 0.6;
}

/* Related Categories */
.related-categories-section {
    margin-top: var(--spacing-xxl);
}

.related-categories-panel {
    padding: var(--spacing-xl);
}

.related-title {
    font-family: var(--font-heading);
    font-size: 1.2rem;
    color: var(--color-lavender);
    margin-bottom: var(--spacing-lg);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.related-categories-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-lg);
}

.related-category-card {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    padding: var(--spacing-lg);
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: var(--border-radius-lg);
    text-decoration: none;
    color: inherit;
    transition: all var(--transition-normal);
}

.related-category-card:hover {
    background: rgba(179, 157, 219, 0.05);
    border-color: rgba(179, 157, 219, 0.2);
    box-shadow: var(--shadow-glow-lavender);
}

.related-category-hexagon {
    flex-shrink: 0;
}

.related-category-info {
    flex: 1;
    min-width: 0;
}

.related-category-name {
    font-family: var(--font-heading);
    font-size: 1rem;
    color: var(--color-text);
    margin: 0 0 var(--spacing-xs) 0;
    transition: color var(--transition-fast);
}

.related-category-card:hover .related-category-name {
    color: var(--color-lavender);
}

.related-category-count {
    font-family: var(--font-code);
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    display: block;
    margin-bottom: var(--spacing-xs);
}

.related-category-desc {
    font-size: 0.85rem;
    color: var(--color-text-tertiary);
    line-height: 1.4;
    margin: 0;
}

.related-category-arrow {
    flex-shrink: 0;
    color: var(--color-lavender);
    font-size: 0.9rem;
    transition: transform var(--transition-fast);
}

.related-category-card:hover .related-category-arrow {
    transform: translateX(5px);
}

/* Responsive Design */
@media (max-width: 991px) {
    .category-hero-display {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-lg);
    }
    
    .category-grid-header {
        flex-direction: column;
        gap: var(--spacing-lg);
        align-items: stretch;
    }
    
    .category-view-controls {
        justify-content: center;
    }
    
    .category-posts-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    }
}

@media (max-width: 767px) {
    .category-display-card {
        padding: var(--spacing-lg);
    }
    
    .category-display-name {
        font-size: 2rem;
    }
    
    .category-stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-md);
    }
    
    .category-view-controls {
        flex-direction: column;
        gap: var(--spacing-md);
    }
    
    .category-posts-grid {
        grid-template-columns: 1fr;
    }
    
    .related-categories-grid {
        grid-template-columns: 1fr;
    }
    
    .related-category-card {
        flex-direction: column;
        text-align: center;
        gap: var(--spacing-md);
    }
}

@media (max-width: 576px) {
    .category-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .hud-select {
        min-width: 120px;
    }
}
</style>
{% endblock %}