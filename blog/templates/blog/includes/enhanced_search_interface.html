<!----
 * AURA DataLogs - Enhanced Search Interface Component
 * Reusable component for advanced search functionality
 * Usage: {--% include 'blog/includes/enhanced_search_interface.html' with style="full" query=query %--}
 * Styles: full, compact, minimal, inline
---->

{% load aura_filters %}
{% load datalog_tags %}

<div class="enhanced-search-interface search-interface-{{ style|default:'full' }}">
    
    {% if style == 'full' %}
    <!-- Full search interface for main pages -->
    <div class="search-container-enhanced">
        <form method="get" action="{% url 'blog:search' %}" class="search-form-enhanced">
            <div class="search-input-wrapper">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
                <input type="text" 
                       name="q" 
                       class="search-input-enhanced" 
                       placeholder="Search DataLog entries, code snippets, and technical insights..."
                       value="{{ query|default:'' }}"
                       autocomplete="off"
                       id="enhancedSearchInput">
                <button type="submit" class="search-submit-btn">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <!-- Dynamic Search Suggestions -->
            <div class="search-suggestions" id="searchSuggestions" style="display: none;">
                <div class="suggestions-header">
                    <i class="fas fa-lightbulb"></i>
                    <span>Search Suggestions</span>
                </div>
                <div class="suggestions-content" id="suggestionsContent">
                    <!-- Dynamic suggestions populated by JavaScript -->
                </div>
            </div>
        </form>
        
        <!-- Quick Filter Tags -->
        <div class="quick-filters">
            <span class="filter-label">Quick Filters:</span>
            <div class="filter-tags">
                <a href="?featured=true" class="filter-tag {% if request.GET.featured %}active{% endif %}">
                    <i class="fas fa-star"></i>
                    <span>Featured</span>
                </a>
                <a href="?has_code=true" class="filter-tag {% if request.GET.has_code %}active{% endif %}">
                    <i class="fas fa-code"></i>
                    <span>Code Examples</span>
                </a>
                <a href="?reading_time=quick" class="filter-tag {% if 'quick' in request.GET.reading_time %}active{% endif %}">
                    <i class="fas fa-clock"></i>
                    <span>Quick Read</span>
                </a>
                <a href="?category=ml" class="filter-tag">
                    <i class="fas fa-brain"></i>
                    <span>Machine Learning</span>
                </a>
                <a href="?category=dev" class="filter-tag">
                    <i class="fas fa-code-branch"></i>
                    <span>Development</span>
                </a>
            </div>
        </div>
    </div>
    
    {% elif style == 'compact' %}
    <!-- Compact search for sidebars and smaller spaces -->
    <div class="search-container-compact">
        <form method="get" action="{% url 'blog:search' %}" class="search-form-compact">
            <div class="search-input-wrapper compact">
                <div class="search-icon">
                    <i class="fas fa-search"></i>
                </div>
                <input type="text" 
                       name="q" 
                       class="search-input-compact" 
                       placeholder="Search entries..."
                       value="{{ query|default:'' }}"
                       autocomplete="off">
                <button type="submit" class="search-submit-btn compact">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </form>
        
        <!-- Compact Quick Filters -->
        <div class="quick-filters-compact">
            <a href="?featured=true" class="filter-chip {% if request.GET.featured %}active{% endif %}" title="Featured Posts">
                <i class="fas fa-star"></i>
            </a>
            <a href="?has_code=true" class="filter-chip {% if request.GET.has_code %}active{% endif %}" title="Code Examples">
                <i class="fas fa-code"></i>
            </a>
            <a href="?reading_time=quick" class="filter-chip {% if 'quick' in request.GET.reading_time %}active{% endif %}" title="Quick Read">
                <i class="fas fa-clock"></i>
            </a>
        </div>
    </div>
    
    {% elif style == 'minimal' %}
    <!-- Minimal search for navigation bars -->
    <div class="search-container-minimal">
        <form method="get" action="{% url 'blog:search' %}" class="search-form-minimal">
            <div class="search-input-wrapper minimal">
                <input type="text" 
                       name="q" 
                       class="search-input-minimal" 
                       placeholder="Search..."
                       value="{{ query|default:'' }}"
                       autocomplete="off">
                <button type="submit" class="search-submit-btn minimal">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </form>
    </div>
    
    {% elif style == 'inline' %}
    <!-- Inline search for archive and category pages -->
    <div class="search-container-inline">
        <form method="get" action="{% url 'blog:search' %}" class="search-form-inline">
            <div class="search-prompt">
                <i class="fas fa-search"></i>
                <input type="text" 
                       name="q" 
                       value="{{ query|default:'' }}" 
                       class="search-input-inline" 
                       placeholder="Search in archive..."
                       autocomplete="off">
            </div>
            <button type="submit" class="search-execute">
                <i class="fas fa-arrow-right"></i>
            </button>
        </form>
    </div>
    
    {% else %}
    <!-- Default: full style -->
    {% include 'blog/includes/enhanced_search_interface.html' with style='full' query=query %}
    {% endif %}
    
</div>

<style>
/* Enhanced Search Interface Component Styles */
.enhanced-search-interface {
    font-family: var(--font-body);
}

/* ========== FULL SEARCH INTERFACE ========== */
.search-container-enhanced {
    margin-bottom: var(--spacing-lg);
    position: relative;
}

.search-form-enhanced {
    position: relative;
}

.search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    background: 
        var(--gradient-glass),
        rgba(7, 7, 18, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--border-radius-xl);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    transition: all var(--transition-fast);
}

.search-input-wrapper:focus-within {
    border-color: var(--color-lavender);
    box-shadow: 0 0 0 2px rgba(179, 157, 219, 0.2), 0 4px 20px rgba(0, 0, 0, 0.3);
    background: 
        var(--gradient-glass),
        rgba(7, 7, 18, 0.8);
}

.search-icon {
    position: absolute;
    left: var(--spacing-lg);
    color: var(--color-lavender);
    font-size: 1.2rem;
    z-index: 2;
    pointer-events: none;
}

.search-input-enhanced {
    width: 100%;
    padding: var(--spacing-lg) var(--spacing-lg) var(--spacing-lg) 3.5rem;
    background: transparent;
    border: none;
    color: var(--color-text);
    font-family: var(--font-body);
    font-size: 1.1rem;
    outline: none;
}

.search-input-enhanced::placeholder {
    color: var(--color-text-tertiary);
}

.search-submit-btn {
    position: absolute;
    right: var(--spacing-sm);
    width: 40px;
    height: 40px;
    background: rgba(179, 157, 219, 0.1);
    border: 1px solid rgba(179, 157, 219, 0.3);
    border-radius: 50%;
    color: var(--color-lavender);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.search-submit-btn:hover {
    background: rgba(179, 157, 219, 0.2);
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(179, 157, 219, 0.4);
}

/* Search Suggestions */
.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: 
        var(--gradient-glass),
        rgba(7, 7, 18, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--border-radius-lg);
    backdrop-filter: blur(20px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    z-index: 100;
    margin-top: var(--spacing-xs);
    max-height: 300px;
    overflow-y: auto;
    opacity: 0;
    transform: translateY(-10px);
    transition: all var(--transition-fast);
}

.search-suggestions.show {
    opacity: 1;
    transform: translateY(0);
}

.suggestions-header {
    padding: var(--spacing-sm) var(--spacing-lg);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.85rem;
    color: var(--color-lavender);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.suggestions-content {
    padding: var(--spacing-sm) 0;
}

.search-suggestion-item {
    padding: var(--spacing-sm) var(--spacing-lg);
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
    border-left: 3px solid transparent;
}

.search-suggestion-item:hover {
    background: rgba(179, 157, 219, 0.1);
    color: var(--color-text);
    border-left-color: var(--color-lavender);
}

.search-suggestion-item i {
    color: var(--color-lavender);
    width: 16px;
    text-align: center;
}

.suggestion-text {
    flex: 1;
}

.suggestion-type {
    font-family: var(--font-code);
    font-size: 0.7rem;
    color: var(--color-text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    background: rgba(255, 255, 255, 0.05);
    padding: 0.2rem 0.4rem;
    border-radius: var(--border-radius-sm);
}

/* Quick Filters */
.quick-filters {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
    margin-top: var(--spacing-md);
}

.filter-label {
    font-family: var(--font-code);
    font-size: 0.85rem;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 1px;
    white-space: nowrap;
}

.filter-tags {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.filter-tag {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-sm);
    background: rgba(179, 157, 219, 0.08);
    border: 1px solid rgba(179, 157, 219, 0.2);
    border-radius: var(--border-radius-sm);
    color: var(--color-text-secondary);
    text-decoration: none;
    font-size: 0.8rem;
    transition: all var(--transition-fast);
    white-space: nowrap;
}

.filter-tag:hover {
    background: rgba(179, 157, 219, 0.15);
    color: var(--color-lavender);
    transform: translateY(-2px);
}

.filter-tag.active {
    background: rgba(179, 157, 219, 0.2);
    color: var(--color-lavender);
    border-color: rgba(179, 157, 219, 0.4);
    box-shadow: 0 0 10px rgba(179, 157, 219, 0.3);
}

.filter-tag i {
    font-size: 0.75rem;
}

/* ========== COMPACT SEARCH INTERFACE ========== */
.search-container-compact {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
}

.search-input-wrapper.compact {
    padding: var(--spacing-sm);
    border-radius: var(--border-radius-lg);
}

.search-input-compact {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-sm) var(--spacing-sm) 2.5rem;
    background: transparent;
    border: none;
    color: var(--color-text);
    font-family: var(--font-body);
    font-size: 1rem;
    outline: none;
}

.search-input-compact::placeholder {
    color: var(--color-text-tertiary);
}

.search-submit-btn.compact {
    width: 32px;
    height: 32px;
    font-size: 0.8rem;
}

.quick-filters-compact {
    display: flex;
    gap: var(--spacing-xs);
    justify-content: center;
}

.filter-chip {
    width: 36px;
    height: 36px;
    background: rgba(179, 157, 219, 0.08);
    border: 1px solid rgba(179, 157, 219, 0.2);
    border-radius: 50%;
    color: var(--color-text-secondary);
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    transition: all var(--transition-fast);
}

.filter-chip:hover {
    background: rgba(179, 157, 219, 0.15);
    color: var(--color-lavender);
    transform: scale(1.1);
}

.filter-chip.active {
    background: rgba(179, 157, 219, 0.2);
    color: var(--color-lavender);
    border-color: rgba(179, 157, 219, 0.4);
    transform: scale(1.05);
}

/* ========== MINIMAL SEARCH INTERFACE ========== */
.search-container-minimal {
    display: flex;
    align-items: center;
}

.search-input-wrapper.minimal {
    display: flex;
    align-items: center;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius-md);
    padding: 0;
    backdrop-filter: blur(10px);
}

.search-input-minimal {
    padding: var(--spacing-sm) var(--spacing-md);
    background: transparent;
    border: none;
    color: var(--color-text);
    font-family: var(--font-body);
    font-size: 0.9rem;
    outline: none;
    min-width: 200px;
}

.search-input-minimal::placeholder {
    color: var(--color-text-tertiary);
}

.search-submit-btn.minimal {
    width: 32px;
    height: 32px;
    background: transparent;
    border: none;
    color: var(--color-lavender);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
}

.search-submit-btn.minimal:hover {
    color: var(--color-text);
    transform: scale(1.1);
}

/* ========== INLINE SEARCH INTERFACE ========== */
.search-container-inline {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.search-form-inline {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex: 1;
}

.search-prompt {
    position: relative;
    display: flex;
    align-items: center;
    flex: 1;
    background: 
        var(--gradient-glass),
        rgba(7, 7, 18, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-sm) var(--spacing-md);
    backdrop-filter: blur(10px);
}

.search-prompt i {
    color: var(--color-lavender);
    margin-right: var(--spacing-sm);
}

.search-input-inline {
    flex: 1;
    background: transparent;
    border: none;
    color: var(--color-text);
    font-family: var(--font-body);
    font-size: 0.9rem;
    outline: none;
}

.search-input-inline::placeholder {
    color: var(--color-text-tertiary);
}

.search-execute {
    width: 36px;
    height: 36px;
    background: rgba(179, 157, 219, 0.1);
    border: 1px solid rgba(179, 157, 219, 0.3);
    border-radius: 50%;
    color: var(--color-lavender);
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
}

.search-execute:hover {
    background: rgba(179, 157, 219, 0.2);
    transform: scale(1.05);
}

/* ========== RESPONSIVE DESIGN ========== */
@media (max-width: 991px) {
    .search-input-enhanced {
        font-size: 1rem;
        padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 3rem;
    }
    
    .search-icon {
        left: var(--spacing-md);
        font-size: 1rem;
    }
    
    .quick-filters {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--spacing-sm);
    }
}

@media (max-width: 767px) {
    .filter-tags {
        justify-content: center;
    }
    
    .search-input-minimal {
        min-width: 150px;
    }
    
    .search-container-inline {
        flex-direction: column;
        gap: var(--spacing-md);
    }
}

@media (max-width: 576px) {
    .search-input-enhanced {
        padding: var(--spacing-sm) var(--spacing-sm) var(--spacing-sm) 2.5rem;
    }
    
    .search-icon {
        left: var(--spacing-sm);
    }
    
    .search-submit-btn {
        width: 36px;
        height: 36px;
    }
    
    .filter-tag span {
        display: none;
    }
    
    .quick-filters-compact {
        flex-wrap: wrap;
    }
}

/* ========== ANIMATION EFFECTS ========== */
@keyframes searchPulse {
    0%, 100% { 
        box-shadow: 0 0 0 0 rgba(179, 157, 219, 0.4); 
    }
    50% { 
        box-shadow: 0 0 0 10px rgba(179, 157, 219, 0); 
    }
}

.search-input-wrapper:focus-within .search-submit-btn {
    animation: searchPulse 2s infinite;
}

/* Loading state for search suggestions */
.suggestions-loading {
    padding: var(--spacing-lg);
    text-align: center;
    color: var(--color-text-tertiary);
}

.suggestions-loading::after {
    content: '';
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(179, 157, 219, 0.3);
    border-top: 2px solid var(--color-lavender);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-left: var(--spacing-sm);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<script>
// Enhanced Search Interface JavaScript
document.addEventListener('DOMContentLoaded', function() {
    initEnhancedSearch();
});

function initEnhancedSearch() {
    const searchInputs = document.querySelectorAll('.search-input-enhanced, .search-input-compact');
    const searchSuggestions = document.getElementById('searchSuggestions');
    
    searchInputs.forEach(input => {
        let searchTimeout;
        
        // Real-time search suggestions
        input.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            
            if (query.length >= 2 && searchSuggestions) {
                searchTimeout = setTimeout(() => {
                    loadSearchSuggestions(query);
                }, 300);
            } else if (searchSuggestions) {
                searchSuggestions.style.display = 'none';
                searchSuggestions.classList.remove('show');
            }
        });
        
        // Show suggestions on focus if there's a query
        input.addEventListener('focus', function() {
            const query = this.value.trim();
            if (query.length >= 2 && searchSuggestions) {
                loadSearchSuggestions(query);
            }
        });
        
        // Enhanced keyboard navigation
        input.addEventListener('keydown', function(e) {
            if (!searchSuggestions || !searchSuggestions.classList.contains('show')) return;
            
            const suggestions = searchSuggestions.querySelectorAll('.search-suggestion-item');
            const currentActive = searchSuggestions.querySelector('.search-suggestion-item.active');
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (currentActive) {
                    currentActive.classList.remove('active');
                    const next = currentActive.nextElementSibling;
                    if (next) {
                        next.classList.add('active');
                    } else {
                        suggestions[0]?.classList.add('active');
                    }
                } else {
                    suggestions[0]?.classList.add('active');
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (currentActive) {
                    currentActive.classList.remove('active');
                    const prev = currentActive.previousElementSibling;
                    if (prev) {
                        prev.classList.add('active');
                    } else {
                        suggestions[suggestions.length - 1]?.classList.add('active');
                    }
                } else {
                    suggestions[suggestions.length - 1]?.classList.add('active');
                }
            } else if (e.key === 'Enter') {
                if (currentActive) {
                    e.preventDefault();
                    currentActive.click();
                }
            } else if (e.key === 'Escape') {
                searchSuggestions.style.display = 'none';
                searchSuggestions.classList.remove('show');
                this.blur();
            }
        });
    });
    
    // Hide suggestions when clicking outside
    document.addEventListener('click', function(e) {
        if (searchSuggestions && !e.target.closest('.search-container-enhanced')) {
            searchSuggestions.style.display = 'none';
            searchSuggestions.classList.remove('show');
        }
    });
    
    // Filter tag interactions
    const filterTags = document.querySelectorAll('.filter-tag, .filter-chip');
    filterTags.forEach(tag => {
        tag.addEventListener('click', function(e) {
            // Add click tracking or analytics here if needed
            console.log('Filter clicked:', this.textContent.trim());
        });
    });
}

function loadSearchSuggestions(query) {
    const searchSuggestions = document.getElementById('searchSuggestions');
    const suggestionsContent = document.getElementById('suggestionsContent');
    
    if (!searchSuggestions || !suggestionsContent) return;
    
    // Show loading state
    suggestionsContent.innerHTML = '<div class="suggestions-loading">Searching...</div>';
    searchSuggestions.style.display = 'block';
    setTimeout(() => searchSuggestions.classList.add('show'), 10);
    
    // Simulate API call with fallback suggestions
    setTimeout(() => {
        const suggestions = generateSearchSuggestions(query);
        displaySearchSuggestions(suggestions);
    }, 500);
}

function generateSearchSuggestions(query) {
    // This would typically be an AJAX call to your Django backend
    // For now, we'll generate some realistic suggestions
    const staticSuggestions = [
        { text: 'Machine Learning Fundamentals', type: 'post', icon: 'fas fa-brain' },
        { text: 'Python Data Analysis', type: 'post', icon: 'fas fa-chart-line' },
        { text: 'Django Best Practices', type: 'post', icon: 'fas fa-code' },
        { text: 'API Development', type: 'category', icon: 'fas fa-plug' },
        { text: 'Database Optimization', type: 'post', icon: 'fas fa-database' },
        { text: 'Neural Networks', type: 'tag', icon: 'fas fa-tag' },
        { text: 'System Architecture', type: 'post', icon: 'fas fa-sitemap' },
    ];
    
    return staticSuggestions.filter(suggestion => 
        suggestion.text.toLowerCase().includes(query.toLowerCase())
    ).slice(0, 5);
}

function displaySearchSuggestions(suggestions) {
    const suggestionsContent = document.getElementById('suggestionsContent');
    if (!suggestionsContent) return;
    
    if (suggestions.length === 0) {
        suggestionsContent.innerHTML = `
            <div class="search-suggestion-item">
                <i class="fas fa-info-circle"></i>
                <span class="suggestion-text">No suggestions found</span>
            </div>
        `;
        return;
    }
    
    const suggestionsHTML = suggestions.map(suggestion => `
        <div class="search-suggestion-item" onclick="selectSuggestion('${suggestion.text}')">
            <i class="${suggestion.icon}"></i>
            <span class="suggestion-text">${suggestion.text}</span>
            <span class="suggestion-type">${suggestion.type}</span>
        </div>
    `).join('');
    
    suggestionsContent.innerHTML = suggestionsHTML;
}

function selectSuggestion(suggestionText) {
    const searchInput = document.querySelector('.search-input-enhanced, .search-input-compact');
    const searchSuggestions = document.getElementById('searchSuggestions');
    
    if (searchInput) {
        searchInput.value = suggestionText;
        if (searchSuggestions) {
            searchSuggestions.style.display = 'none';
            searchSuggestions.classList.remove('show');
        }
        
        // Submit the form
        const form = searchInput.closest('form');
        if (form) {
            form.submit();
        }
    }
}

// Export functions for global access
window.loadSearchSuggestions = loadSearchSuggestions;
window.selectSuggestion = selectSuggestion;
</script>