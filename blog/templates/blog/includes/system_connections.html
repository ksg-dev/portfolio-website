<!----
 * AURA DataLogs - System Connections Component
 * Reusable component for displaying related systems/projects
 * Usage: {--% include 'blog/includes/system_connections.html' with post=post style="full" %--}
 * Styles: full, compact, minimal, badge
---->

{% load aura_filters %}
{% load datalog_tags %}

{% if post.has_system_connections %}
<div class="system-connections-display system-connections-{{ style|default:'compact' }}">
    
    {% if style == 'full' %}
    <!-- Full system connections for detail pages -->
    <div class="connections-header">
        <h3 class="connections-title">
            <i class="fas fa-link"></i>
            Connected Systems
        </h3>
        <div class="connections-meta">
            <span class="connections-count">{{ post.get_system_connections.count }} connection{{ post.get_system_connections.count|pluralize }}</span>
        </div>
    </div>
    
    <div class="connections-grid">
        {% for connection in post.get_system_connections %}
        <a href="{{ connection.system.get_absolute_url }}" class="connection-card">
            <div class="connection-header">
                <div class="connection-icon">
                    <i class="{{ connection.get_connection_icon }}"></i>
                </div>
                <div class="connection-status">
                    <div class="status-indicator {{ connection.system.status }}"></div>
                </div>
            </div>
            
            <div class="connection-content">
                <div class="connection-id">{{ connection.system.system_id }}</div>
                <div class="connection-title">{{ connection.system.title }}</div>
                <div class="connection-type">{{ connection.get_connection_type_display }}</div>
                
                {% if connection.system.completion_percent %}
                <div class="connection-progress">
                    <div class="progress-label">
                        <span>Progress</span>
                        <span class="progress-value">{{ connection.system.completion_percent }}%</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: {{ connection.system.completion_percent }}%; background: {{ connection.get_status_color }};"></div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <div class="connection-footer">
                <div class="connection-priority priority-{{ connection.priority }}">
                    <i class="fas fa-flag"></i>
                    <span>{{ connection.get_priority_display }}</span>
                </div>
                <div class="connection-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </div>
            
            <!-- Scanning line effect -->
            <div class="connection-scanning-line"></div>
        </a>
        {% endfor %}
    </div>
    
    {% elif style == 'compact' %}
    <!-- Compact connections for cards and lists -->
    <div class="connections-compact">
        <div class="connections-label">
            <i class="fas fa-link"></i>
            <span>Systems ({{ post.get_system_connections.count }})</span>
        </div>
        
        <div class="connections-list">
            {% for connection in post.get_system_connections|slice:":3" %}
            <a href="{{ connection.system.get_absolute_url }}" class="connection-chip">
                <div class="chip-status">
                    <div class="status-indicator {{ connection.system.status }}"></div>
                </div>
                <div class="chip-content">
                    <span class="chip-id">{{ connection.system.system_id }}</span>
                    <span class="chip-title">{{ connection.system.title|truncate_smart:20 }}</span>
                </div>
                <div class="chip-type">{{ connection.connection_type|slice:":3"|upper }}</div>
            </a>
            {% endfor %}
            
            {% if post.get_system_connections.count > 3 %}
            <div class="connection-overflow">
                +{{ post.get_system_connections.count|add:"-3" }} more
            </div>
            {% endif %}
        </div>
    </div>
    
    {% elif style == 'minimal' %}
    <!-- Minimal connections for tight spaces -->
    <div class="connections-minimal">
        <span class="connections-icon">
            <i class="fas fa-link"></i>
        </span>
        <span class="connections-text">
            {{ post.get_system_connections.count }} system{{ post.get_system_connections.count|pluralize }}
        </span>
        {% if post.get_primary_system %}
        <span class="primary-system">
            ({{ post.get_primary_system.system_id }})
        </span>
        {% endif %}
    </div>
    
    {% elif style == 'badge' %}
    <!-- Badge style for navigation and breadcrumbs -->
    <div class="connections-badge">
        <div class="badge-icon">
            <i class="fas fa-project-diagram"></i>
        </div>
        <div class="badge-content">
            <span class="badge-count">{{ post.get_system_connections.count }}</span>
            <span class="badge-label">System{{ post.get_system_connections.count|pluralize }}</span>
        </div>
    </div>
    
    {% else %}
    <!-- Default: compact style -->
    {% include 'blog/includes/system_connections.html' with post=post style='compact' %}
    {% endif %}
    
</div>
{% endif %}

<style>
/* System Connections Component Styles */
.system-connections-display {
    font-family: var(--font-body);
}

/* Full Connections Grid */
.connections-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.connections-title {
    font-family: var(--font-heading);
    font-size: 1.2rem;
    color: var(--color-coral);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.connections-meta {
    font-family: var(--font-code);
    font-size: 0.85rem;
    color: var(--color-text-secondary);
}

.connections-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-lg);
}

.connection-card {
    background: 
        var(--gradient-glass),
        rgba(255, 138, 128, 0.05);
    border: 1px solid rgba(255, 138, 128, 0.2);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-lg);
    text-decoration: none;
    color: var(--color-text);
    transition: all var(--transition-normal);
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(15px);
}

.connection-card:hover {
    background: 
        var(--gradient-glass),
        rgba(255, 138, 128, 0.1);
    border-color: rgba(255, 138, 128, 0.4);
    transform: translateY(-5px) scale(1.02);
    box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.3),
        0 0 20px rgba(255, 138, 128, 0.2);
    color: var(--color-text);
}

.connection-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-md);
}

.connection-icon {
    width: 40px;
    height: 40px;
    background: rgba(255, 138, 128, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-coral);
    font-size: 1.1rem;
}

.connection-status .status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.connection-content {
    margin-bottom: var(--spacing-md);
}

.connection-id {
    font-family: var(--font-code);
    font-size: 0.8rem;
    color: var(--color-coral);
    background: rgba(255, 138, 128, 0.1);
    padding: 0.2rem 0.5rem;
    border-radius: var(--border-radius-sm);
    display: inline-block;
    margin-bottom: var(--spacing-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.connection-title {
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--spacing-xs);
    font-size: 1rem;
    line-height: 1.3;
}

.connection-type {
    font-family: var(--font-code);
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--spacing-sm);
}

.connection-progress {
    margin-top: var(--spacing-sm);
}

.progress-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-xs);
}

.progress-value {
    font-family: var(--font-code);
    color: var(--color-text);
    font-weight: 600;
}

.progress-bar-container {
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
}

.progress-bar {
    height: 100%;
    border-radius: 2px;
    transition: width var(--transition-normal);
}

.connection-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.connection-priority {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.8rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--border-radius-sm);
    font-family: var(--font-code);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.connection-priority.priority-1 {
    background: rgba(94, 223, 255, 0.2);
    color: #5edfff;
}

.connection-priority.priority-2 {
    background: rgba(38, 198, 218, 0.2);
    color: var(--color-teal);
}

.connection-priority.priority-3 {
    background: rgba(255, 189, 46, 0.2);
    color: #ffbd2e;
}

.connection-priority.priority-4 {
    background: rgba(255, 107, 139, 0.2);
    color: #ff6b8b;
}

.connection-arrow {
    color: var(--color-coral);
    font-size: 0.9rem;
    transition: transform var(--transition-fast);
}

.connection-card:hover .connection-arrow {
    transform: translateX(5px);
}

.connection-scanning-line {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(255, 138, 128, 0.1) 50%, 
        transparent 100%);
    transition: left var(--transition-slow);
    pointer-events: none;
}

.connection-card:hover .connection-scanning-line {
    left: 100%;
}

/* Compact Connections */
.connections-compact {
    background: rgba(255, 138, 128, 0.05);
    border: 1px solid rgba(255, 138, 128, 0.2);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-md);
}

.connections-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-family: var(--font-code);
    font-size: 0.85rem;
    color: var(--color-coral);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.connections-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
    align-items: center;
}

.connection-chip {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-xs) var(--spacing-sm);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius-md);
    text-decoration: none;
    color: var(--color-text-secondary);
    font-size: 0.8rem;
    transition: all var(--transition-fast);
    white-space: nowrap;
}

.connection-chip:hover {
    background: rgba(255, 138, 128, 0.1);
    border-color: rgba(255, 138, 128, 0.3);
    color: var(--color-text);
    transform: translateY(-2px);
}

.chip-status .status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}

.chip-content {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
    min-width: 0;
}

.chip-id {
    font-family: var(--font-code);
    font-size: 0.7rem;
    color: var(--color-coral);
    font-weight: 600;
}

.chip-title {
    font-size: 0.75rem;
    color: var(--color-text);
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.chip-type {
    font-family: var(--font-code);
    font-size: 0.65rem;
    color: var(--color-text-tertiary);
    background: rgba(255, 255, 255, 0.05);
    padding: 0.1rem 0.3rem;
    border-radius: var(--border-radius-sm);
    font-weight: 600;
}

.connection-overflow {
    font-family: var(--font-code);
    font-size: 0.75rem;
    color: var(--color-text-tertiary);
    padding: var(--spacing-xs) var(--spacing-sm);
    background: rgba(255, 255, 255, 0.02);
    border: 1px dashed rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius-md);
}

/* Minimal Connections */
.connections-minimal {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-size: 0.8rem;
    color: var(--color-text-tertiary);
}

.connections-icon {
    color: var(--color-coral);
}

.primary-system {
    font-family: var(--font-code);
    color: var(--color-coral);
    font-weight: 600;
}

/* Badge Connections */
.connections-badge {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background: rgba(255, 138, 128, 0.1);
    border: 1px solid rgba(255, 138, 128, 0.3);
    border-radius: var(--border-radius-md);
    font-family: var(--font-code);
    font-size: 0.85rem;
}

.badge-icon {
    color: var(--color-coral);
}

.badge-content {
    display: flex;
    flex-direction: column;
    gap: 0.1rem;
}

.badge-count {
    color: var(--color-text);
    font-weight: 600;
    line-height: 1;
}

.badge-label {
    color: var(--color-text-secondary);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    line-height: 1;
}

/* Status Indicator Colors */
.status-indicator.draft { background: #808080; }
.status-indicator.in_development { background: #ffbd2e; }
.status-indicator.testing { background: #ff6b8b; }
.status-indicator.deployed { background: #27c93f; }
.status-indicator.published { background: #00f0ff; }
.status-indicator.archived { background: #666666; }

/* Responsive Design */
@media (max-width: 991px) {
    .connections-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--spacing-md);
    }
    
    .connection-card {
        padding: var(--spacing-md);
    }
}

@media (max-width: 767px) {
    .connections-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
    }
    
    .connections-header {
        flex-direction: column;
        gap: var(--spacing-sm);
        text-align: center;
    }
    
    .connections-list {
        flex-direction: column;
        align-items: stretch;
    }
    
    .connection-chip {
        justify-content: space-between;
    }
}

@media (max-width: 576px) {
    .connection-content {
        margin-bottom: var(--spacing-sm);
    }
    
    .connection-footer {
        flex-direction: column;
        gap: var(--spacing-sm);
        align-items: flex-start;
    }
    
    .connections-compact {
        padding: var(--spacing-sm);
    }
}
</style>