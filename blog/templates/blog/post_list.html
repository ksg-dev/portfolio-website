<!----
 * AURA Portfolio - DataLogs List Template - COMPLETELY UPDATED
 * Advanced User Repository & Archive - Enhanced with Phase 2+ Components
 * Version: 3.0.0 - Maximum component reuse and streamlined code
---->

{% extends "blog/datalogs_base.html" %}
{% load static %}
{% load aura_filters %}
{% load aura_components %}
{% load datalog_tags %}

{% block datalogs_title %}DataLogs Archive{% endblock %}

{% block datalogs_css %}
<!-- All styling now handled by consolidated CSS -->
{% endblock %}

{% block show_breadcrumbs %}False{% endblock %}
{% block show_filters %}True{% endblock %}

{% block datalogs_content %}

<!-- Enhanced Search Interface (NEW COMPONENT) -->
<section class="datalogs-search-section">
    <div class="container">
        {% search_suggestions query=query style='full' enable_ajax=True max_suggestions=8 show_descriptions=True %}
    </div>
</section>

<!-- Category Navigation using Phase 1 Component (ENHANCED) -->
<section class="categories-navigation-section">
    <div class="container">
        {% category_hexagon_nav style="full" current_category=current_category show_all=True limit=None %}
    </div>
</section>

<!-- Featured DataLog Entry (STREAMLINED) -->
{% if featured_post %}
<section class="featured-datalog-section">
    <div class="container">
        {% section_header title="Featured DataLog Entry" subtitle="Highlighted Technical Insights" icon="fas fa-star" show_metrics=True metric_1_value=featured_post.reading_time|format_duration metric_1_label="Read Time" metric_1_icon="fas fa-clock" metric_2_value=featured_post.category.name metric_2_label="Category" metric_2_icon="fas fa-folder" %}
        
        <div class="featured-datalog-container">
            <!-- Featured Post Content using NEW META COMPONENT -->
            <div class="featured-content">
                <!-- Use new meta display component -->
                {% datalog_meta_display featured_post style='detailed' show_author=True show_systems=True show_featured=True %}
                
                <h2 class="featured-title">
                    <a href="{{ featured_post.get_absolute_url }}">{{ featured_post.title }}</a>
                </h2>
                
                {% if featured_post.excerpt %}
                <p class="featured-excerpt">{{ featured_post.excerpt|truncate_smart:200 }}</p>
                {% endif %}
                
                <div class="featured-actions">
                    <a href="{{ featured_post.get_absolute_url }}" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i>
                        Read Full DataLog
                    </a>
                    
                    <!-- Use system connections component if available -->
                    {% if featured_post.related_systems.exists %}
                    {% include 'blog/includes/system_connections.html' with post=featured_post style='compact' %}
                    {% endif %}
                </div>
            </div>
            
            <!-- Enhanced Terminal Display (EXISTING COMPONENT) -->
            {% if featured_post.featured_code %}
            {% terminal_display post=featured_post style="enhanced" %}
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

<!-- DataLog Entries using NEW DATA GRID COMPONENT -->
<section class="datalogs-grid-section">
    <div class="container">
        
        <!-- Enhanced Header with Statistics using existing section_header -->
        {% section_header title="DataLog Entries" subtitle="Technical Documentation Archive" icon="fas fa-database" show_metrics=True metric_1_value=page_obj.paginator.count|default:posts|length metric_1_label="Total Entries" metric_1_icon="fas fa-file-alt" metric_2_value=current_category.name|default:"All Categories" metric_2_label="Category" metric_2_icon="fas fa-folder" metric_3_value=posts|length metric_3_label="Showing" metric_3_icon="fas fa-eye" animated=True %}
        
        <!-- Use NEW DATA GRID component for all post display -->
        {% include 'components/data_grid.html' with items=posts grid_type="datalogs" columns=3 show_controls=True show_sort=True show_filters=True allow_compact=True view_mode="grid" count_label="DataLog entries" %}
        
    </div>
</section>

<!-- Enhanced Pagination (SIMPLIFIED using existing patterns) -->
{% if is_paginated %}
<section class="pagination-section">
    <div class="container">
        {% render_pagination page_obj request %}
    </div>
</section>
{% endif %}

<!-- Filter Panel (NEW COMPONENT) - Handled by datalogs_base.html but enhanced -->
<!-- The filter panel is automatically included via datalogs_base.html show_filters=True -->
<!-- Enhanced with our new datalog_filters_panel component -->

{% endblock %}

{% block datalogs_js %}
<!-- All JavaScript now handled by consolidated JS -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Enhanced post list specific initialization
    if (window.datalogInterface) {
        // Initialize search suggestions with AJAX
        window.datalogInterface.initializeSearchSuggestions({
            container: '.datalogs-search-section',
            enableAjax: true,
            debounceDelay: 300,
            minQueryLength: 2
        });
        
        // Initialize enhanced filtering
        window.datalogInterface.initializeEnhancedFilters({
            autoApply: false,
            multiSelect: true,
            saveState: true
        });
        
        // Initialize data grid functionality
        window.datalogInterface.initializeDataGrid({
            container: '#dataGridContainer',
            defaultView: 'grid',
            enableSorting: true,
            enableFiltering: true
        });
        
        // Track list view analytics
        window.datalogInterface.trackEvent('page_view', {
            page_type: 'post_list',
            category: '{{ current_category.slug|default:"all" }}',
            total_posts: {{ posts|length }},
            has_query: {% if query %}'{{ query|length }}'{% else %}false{% endif %}
        });
    }
});
</script>
{% endblock %}