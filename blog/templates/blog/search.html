{% extends "blog/datalogs_base.html" %}
{% load static %}
{% load aura_filters %}
{% load aura_components %}
{% load datalog_tags %}

{% block datalogs_title %}{% if query %}Search: "{{ query }}"{% else %}Search DataLogs{% endif %}{% endblock %}

{% block show_breadcrumbs %}{% if query %}True{% else %}False{% endif %}{% endblock %}
{% block show_filters %}True{% endblock %}

{% if query %}
{% block datalogs_breadcrumbs %}
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item active">
    <i class="fas fa-search"></i>
    <span>Search: "{{ query|truncate_smart:30 }}"</span>
</span>
{% endblock %}
{% endif %}

{% block datalogs_content %}
{% if query %}
<!-- ========== SEARCH RESULTS MODE ========== -->

<!-- Enhanced Search Interface for results page -->
<section class="search-interface-section">
    <div class="container">
        {% search_suggestions query style='compact' enable_ajax=True max_suggestions=5 show_descriptions=False %}
    </div>
</section>

{% comment %} <!-- Search Results Summary -->
<section class="search-results-summary">
    <div class="container">
        {% section_header title="Search Results" subtitle="PARAMETERS: {{ query }}" icon="fas fa-search" show_metrics=True metric_1_value=search_metadata.total_results|default:total_results|default:0 metric_1_label="Results Found" metric_1_icon="fas fa-database" metric_2_value=active_filters|length|default:0 metric_2_label="Filters Applied" metric_2_icon="fas fa-filter" metric_3_value=search_metadata.sort_by|default:"relevance"|title metric_3_label="Sort Method" metric_3_icon="fas fa-sort" %}
    </div>
</section> {% endcomment %}

<!-- Active Filters Display -->
{% if active_filters %}
<section class="active-filters-section">
    <div class="container">
        <div class="active-filters-display glass-effect">
            <div class="filters-header breadcrumb-item">
                <i class="fas fa-filter"></i>
                <span class="filters-title">Active Filters</span>
            </div>
            
            <div class="filters-list subnav-stats">
                {% for key, value in active_filters.items %}
                <div class="active-filter-item">
                    <span class="filter-name">{{ key|title }}</span>
                    <span class="filter-value">{{ value }}</span>
                    <a href="{% build_url sort=search_metadata.sort_by %}" class="remove-filter-btn">
                        <i class="fas fa-times"></i>
                    </a>
                </div>
                {% endfor %}
                
                <a href="{% url 'blog:search' %}?q={{ query }}" class="clear-all-filters-btn">
                    <i class="fas fa-times-circle"></i>
                    <span>Clear All</span>
                </a>
            </div>
        </div>
    </div>
</section>
{% endif %}

<!-- Search Results -->
<section class="search-results-section">
    <div class="container">
        
        {% if posts %}
        <!-- Results using data grid component -->
        {% include 'components/data_grid.html' with items=posts grid_type="datalogs" columns=3 show_controls=True show_sort=True show_filters=False allow_compact=True view_mode="grid" count_label="search results" %}
        
        {% else %}
        <!-- No Results State -->
        <div class="datalog-unified-container" style="glass-effect glass-card-error">
            <!-- Container Header -->
            <div class="unified-container-header">
                <h3 class="unified-container-title"><i class="fas fa-search"></i> No DataLogs matching query: "{{ query|upper }}"</h3>
            </div>
            <div class="unified-content tags-header">
                <h6 style="font-weight: 500;">Adjust parameters or browse topics below.</h6>
            </div>
                <!-- Search suggestions for no results -->
                <div class="unified-section no-results-suggestions">
                    <h4 class="tags-header">Try searching for:</h4>
                    <div class="unified-tags-list">
                        {% for tag in popular_tags|slice:":8" %}
                        <a href="{% url 'blog:search' %}?q={{ tag.name }}" class="unified-tag">
                            <i class="fas fa-tag"></i>
                            <span>{{ tag.name }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            
                <!-- Quick actions using existing components -->
                {% search_quick_actions query='' as quick_actions %}
                {% if quick_actions %}
                <div class="quick-actions-section unified-container-footer">
                    <div class="unified-footer-actions">
                        {% for action in quick_actions %}
                        <a href="{{ action.url }}" class="quick-action-btn">
                            <i class="{{ action.icon }}"></i>
                            <span>{{ action.text }}</span>
                        </a>
                        {% endfor %}
                </div>
                {% endif %}
        </div>
        {% endif %}
        
    </div>
</section>

<!-- Enhanced Pagination -->
{% if is_paginated %}
<section class="pagination-section">
    <div class="container">
        {% render_pagination page_obj request %}
    </div>
</section>
{% endif %}

{% else %}
<!-- ========== SEARCH LANDING PAGE MODE ========== -->

<!-- Search Landing Page -->
<section class="search-landing-section">
    <div class="container">
        
        <!-- Welcome Search Interface -->
        {% glass_card title="Search DataLogs Archive" subtitle="Find technical documentation and insights" icon="fas fa-search" %}
            
            <!-- Enhanced search form -->
            <form method="get" class="search-landing-form">
                <div class="search-landing-input-wrapper">
                    <i class="fas fa-search search-landing-icon"></i>
                    <input type="text" 
                           name="q" 
                           class="search-landing-input" 
                           placeholder="Search through technical documentation, code examples, and insights..."
                           autocomplete="off"
                           autofocus>
                    <button type="submit" class="search-landing-submit">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <!-- Quick search suggestions -->
                <div class="search-landing-suggestions">
                    <div class="suggestions-header">
                        <i class="fas fa-lightbulb"></i>
                        <span>Popular searches:</span>
                    </div>
                    <div class="suggestions-list">
                        <a href="{% url 'blog:search' %}?q=machine+learning" class="suggestion-link">Machine Learning</a>
                        <a href="{% url 'blog:search' %}?q=python" class="suggestion-link">Python Development</a>
                        <a href="{% url 'blog:search' %}?q=api+design" class="suggestion-link">API Design</a>
                        <a href="{% url 'blog:search' %}?q=database" class="suggestion-link">Database</a>
                        <a href="{% url 'blog:search' %}?q=neural+networks" class="suggestion-link">Neural Networks</a>
                    </div>
                </div>
            </form>
            
        {% endglass_card %}
        
        <!-- Search Stats and Categories -->
        {% comment %} <div class="search-landing-grid">
            
            <!-- Search Statistics -->
            {% glass_card title="Archive Statistics" icon="fas fa-chart-bar" size="sm" %}
                
                <div class="search-stats-grid subnav-stats">
                    <div class="stat-item">
                        <span class="stat-value">{{ total_posts|default:"24" }}</span>
                        <span class="stat-label">DataLog Entries</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ categories.count }}</span>
                        <span class="stat-label">Categories</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ popular_tags.count }}</span>
                        <span class="stat-label">Topics</span>
                    </div>
                </div>
                
            {% endglass_card %}
            
            <!-- Browse Categories -->
            {% glass_card title="Browse by Category" icon="fas fa-folder" size="sm" %}
                
                <div class="category-browse-list">
                    {% for category in categories|slice:":6" %}
                    <a href="{% url 'blog:category' slug=category.slug %}" class="category-browse-item breadcrumb-item">
                        <div class="category-hex-mini" style="--hex-color: {{ category.color }};">
                            <span class="hex-code">{{ category.code|default:"CAT" }}</span>
                        </div>
                        <span class="category-name">{{ category.name }}</span>
                        <span class="category-count">({{ category.post_count }})</span>
                    </a>
                    {% endfor %}
                </div>
                
                <div class="browse-all-link">
                    <a href="{% url 'blog:post_list' %}" class="browse-all-btn">
                        <span>View All Categories</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
            {% endglass_card %}
            
        </div> {% endcomment %}
        
    </div>
</section>
<!-- Enhanced Search Interface using new component -->
<section class="search-interface-section">
    <div class="container">
        {% search_suggestions query="" style='full' enable_ajax=True max_suggestions=8 show_descriptions=True %}
    </div>
</section>

{% endif %}

{% endblock %}