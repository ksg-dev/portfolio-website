<!----
 * AURA DataLogs - Main Archive Template
 * File: blog/templates/blog/archive.html
 * Complete archive with dynamic timeline
---->

{% extends "blog/datalogs_base.html" %}
{% load static %}
{% load aura_filters %}
{% load aura_components %}
{% load datalog_tags %}

{% block title %}{{ page_title }} | AURA{% endblock %}
{% block meta_description %}{{ page_description }}{% endblock %}

{% block datalogs_title %}DataLogs Archive{% endblock %}

{% block datalogs_css %}
<link rel="stylesheet" href="{% static 'blog/css/datalogs-consolidated.css' %}">
{% endblock %}

{% block datalogs_body_class %}archive-view{% endblock %}

{% block datalogs_breadcrumbs %}
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item active">Archive</span>
{% if current_category %}
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item">{{ current_category.name }}</span>
{% endif %}
{% if current_year %}
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item">{{ current_year }}</span>
{% if current_month %}
<i class="fas fa-chevron-right breadcrumb-separator"></i>
<span class="breadcrumb-item">{{ current_month|date:"F" }}</span>
{% endif %}
{% endif %}
{% endblock %}

{% block datalogs_content %}

<!-- Archive Header with Stats -->
<section class="archive-header-section">
    {% section_header title="DataLogs Archive" subtitle="Complete chronological repository of technical insights" icon="fas fa-archive" show_metrics=True metric_1_value=total_posts_in_archive metric_1_label="Total Entries" metric_1_icon="fas fa-database" metric_2_value=posts.dates.year.count|default:"0" metric_2_label="Active Years" metric_2_icon="fas fa-calendar" metric_3_value=posts.categories.count|default:"0" metric_3_label="Categories" metric_3_icon="fas fa-folder" %}
</section>

<!-- Archive Filters -->
{% if show_timeline_filters %}
<section class="archive-filters-section">
    <div class="glass-card archive-filters-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-filter"></i>
                Archive Filters
            </h3>
        </div>
        <div class="card-content">
            {% archive_filter_options posts current_year current_month as filter_options %}
            
            <form method="get" class="archive-filter-form">
                <div class="filter-grid">
                    <!-- Year Filter -->
                    {% if filter_options.years %}
                    <div class="filter-group">
                        <label class="filter-label">Year</label>
                        <select name="year" class="hud-select filter-select">
                            <option value="">All Years</option>
                            {% for year_data in filter_options.years %}
                            <option value="{{ year_data.year }}" {% if year_data.is_current %}selected{% endif %}>
                                {{ year_data.year }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    
                    <!-- Month Filter -->
                    {% if filter_options.months %}
                    <div class="filter-group">
                        <label class="filter-label">Month</label>
                        <select name="month" class="hud-select filter-select">
                            <option value="">All Months</option>
                            {% for month_data in filter_options.months %}
                            <option value="{{ month_data.number }}" {% if month_data.is_current %}selected{% endif %}>
                                {{ month_data.name }} ({{ month_data.count }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    
                    <!-- Category Filter -->
                    {% if filter_options.categories %}
                    <div class="filter-group">
                        <label class="filter-label">Category</label>
                        <select name="category" class="hud-select filter-select">
                            <option value="">All Categories</option>
                            {% for category in filter_options.categories %}
                            <option value="{{ category.slug }}" {% if category == current_category %}selected{% endif %}>
                                {{ category.name }} ({{ category.archive_post_count }})
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    {% endif %}
                    
                    <!-- Filter Actions -->
                    <div class="filter-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-filter"></i>
                            Apply Filters
                        </button>
                        <a href="{% url 'blog:archive' %}" class="btn btn-outline">
                            <i class="fas fa-times"></i>
                            Clear All
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>
{% endif %}

<!-- Main Archive Timeline -->
<section class="archive-timeline-section">
    {% archive_timeline posts=posts style=archive_style group_by='month' show_stats=show_timeline_stats show_navigation=show_timeline_navigation year=current_year month=current_month auto_expand=True max_posts_per_group=6 %}
</section>

<!-- Archive Navigation -->
{% if show_timeline_navigation %}
<section class="archive-navigation-section">
    <div class="glass-card archive-nav-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-compass"></i>
                Quick Navigation
            </h3>
        </div>
        <div class="card-content">
            {% archive_navigation_data posts current_year current_month as nav_data %}
            
            {% if nav_data.has_navigation %}
            <div class="archive-quick-nav">
                <!-- Recent Years -->
                <div class="quick-nav-section">
                    <h4 class="nav-section-title">Recent Years</h4>
                    <div class="quick-nav-grid">
                        {% for year_data in nav_data.years|slice:":5" %}
                        <a href="{{ year_data.url }}" class="quick-nav-item breadcrumb-item">
                            <span class="nav-year">{{ year_data.year }}</span>
                            <span class="nav-count">{{ year_data.total_posts }} posts</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Current Year Months -->
                {% if current_year and nav_data.years.0.months %}
                <div class="quick-nav-section">
                    <h4 class="nav-section-title">{{ current_year }} Months</h4>
                    <div class="quick-nav-grid months-grid">
                        {% for month_data in nav_data.years.0.months %}
                        <a href="{{ month_data.url }}" class="quick-nav-item breadcrumb-item month-nav {% if month_data.is_current %}active{% endif %}">
                            <span class="nav-month">{{ month_data.short_name }}</span>
                            <span class="nav-count">{{ month_data.count }}</span>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}

<!-- Archive Statistics -->
{% if show_timeline_stats %}
<section class="archive-statistics-section">
    <div class="archive-stats-card">
    {% archive_summary_stats posts 'month' as summary_stats %}
    <div class="glass-card archive-stats-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-chart-bar"></i>
                Archive Statistics
            </h3>
        </div>
        <div class="card-content">
            <div class="archive-stats-grid">
                {% metric_card summary_stats.total_periods "Time Periods" icon="fas fa-calendar" color="teal" size="md" %}
                {% metric_card summary_stats.avg_posts_per_period "Avg per Period" icon="fas fa-chart-line" color="lavender" size="md" %}
                {% metric_card summary_stats.most_posts_in_period "Most Active" icon="fas fa-fire" color="coral" size="md" %}
                
                {% if summary_stats.most_active_period %}
                <div class="stat-highlight-card glass-card">
                    <div class="card-content">
                        <h4 class="stat-title">Most Active Period</h4>
                        <div class="stat-content">
                            <span class="stat-period">{% archive_period_display summary_stats.most_active_period 'month' %}</span>
                            <span class="stat-value">{{ summary_stats.most_posts_in_period }} posts</span>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endif %}

{% endblock %}

{% block datalogs_js %}
<script src="{% static 'blog/js/datalogs-consolidated.js' %}"></script>
{% endblock %}