 <!-- projects/templates/projects/admin/system_list.html -->
 {% extends 'admin/list.html' %}
 {% load static %}
 {% load admin_filters %}
 
 {% block header_actions %}
     <!-- Advanced System Filters -->
     <div class="system-filters-bar">
         <form method="get" class="filters-form">
             <div class="filters-row">
                 <div class="search-group">
                     <input type="text" 
                            name="search" 
                            value="{{ search_query }}" 
                            placeholder="Search systems, technologies, descriptions..." 
                            class="form-control search-input">
                     <button class="btn btn-outline-secondary search-btn" type="submit">
                         <i class="fas fa-search"></i>
                     </button>
                     {% if search_query %}
                         <a href="?" class="btn btn-outline-secondary clear-btn">
                             <i class="fas fa-times"></i>
                         </a>
                     {% endif %}
                 </div>
                 
                 <div class="filter-group">
                     <select name="status" class="form-select filter-select" onchange="this.form.submit()">
                         <option value="">All Status</option>
                         <option value="deployed" {% if current_filters.status == 'deployed' %}selected{% endif %}>Deployed</option>
                         <option value="published" {% if current_filters.status == 'published' %}selected{% endif %}>Published</option>
                         <option value="in_development" {% if current_filters.status == 'in_development' %}selected{% endif %}>In Development</option>
                     </select>
                     
                     <select name="type" class="form-select filter-select" onchange="this.form.submit()">
                         <option value="">All Types</option>
                         {% for type in system_types %}
                             <option value="{{ type.slug }}" {% if current_filters.type == type.slug %}selected{% endif %}>
                                 {{ type.name }}
                             </option>
                         {% endfor %}
                     </select>
                     
                     <select name="priority" class="form-select filter-select" onchange="this.form.submit()">
                         <option value="">All Priorities</option>
                         <option value="4" {% if current_filters.priority == '4' %}selected{% endif %}>Critical</option>
                         <option value="3" {% if current_filters.priority == '3' %}selected{% endif %}>High</option>
                         <option value="2" {% if current_filters.priority == '2' %}selected{% endif %}>Medium</option>
                         <option value="1" {% if current_filters.priority == '1' %}selected{% endif %}>Low</option>
                     </select>
                     
                     <select name="health" class="form-select filter-select" onchange="this.form.submit()">
                         <option value="">All Health</option>
                         <option value="healthy" {% if current_filters.health == 'healthy' %}selected{% endif %}>Healthy</option>
                         <option value="warning" {% if current_filters.health == 'warning' %}selected{% endif %}>Warning</option>
                         <option value="critical" {% if current_filters.health == 'critical' %}selected{% endif %}>Critical</option>
                     </select>
                 </div>
                 
                 <div class="view-controls">
                     <div class="btn-group" role="group">
                         <button type="button" class="btn btn-outline-secondary view-btn active" data-view="grid">
                             <i class="fas fa-th"></i>
                         </button>
                         <button type="button" class="btn btn-outline-secondary view-btn" data-view="table">
                             <i class="fas fa-list"></i>
                         </button>
                     </div>
                 </div>
             </div>
         </form>
     </div>
     
     <a href="{{ create_url }}" class="btn btn-admin-primary">
         <i class="fas fa-plus me-2"></i>
         Deploy New System
     </a>
 {% endblock %}
 
 {% block additional_bulk_actions %}
     <button type="button" class="btn btn-sm btn-outline-success" data-action="deploy">
         <i class="fas fa-rocket me-1"></i>
         Deploy
     </button>
     <button type="button" class="btn btn-sm btn-outline-info" data-action="publish">
         <i class="fas fa-check me-1"></i>
         Publish
     </button>
     <button type="button" class="btn btn-sm btn-outline-warning" data-action="feature">
         <i class="fas fa-star me-1"></i>
         Feature
     </button>
     <button type="button" class="btn btn-sm btn-outline-secondary" data-action="update_health">
         <i class="fas fa-heartbeat me-1"></i>
         Health Check
     </button>
 {% endblock %}
 
 {% block table_headers %}
     <th width="50">Status</th>
     <th>System Details</th>
     <th width="120">Type</th>
     <th width="150">Performance</th>
     <th width="120">Technologies</th>
     <th width="100">Priority</th>
     <th width="120">Updated</th>
     <th width="150">Actions</th>
 {% endblock %}
 
 {% block table_row %}
     <td>
         <div class="system-status-column">
             <div class="status-indicator status-{{ system.status }}">
                 <div class="status-dot"></div>
             </div>
             <div class="health-indicator health-{{ system.health_status }}">
                 <i class="fas fa-circle"></i>
             </div>
         </div>
     </td>
     <td>
         <div class="system-details">
             <div class="system-header">
                 <h5 class="system-name">
                     <a href="{{ system.get_absolute_url }}" target="_blank" class="system-link">
                         {{ system.name }}
                     </a>
                     {% if system.featured %}
                         <i class="fas fa-star featured-star" title="Featured System"></i>
                     {% endif %}
                 </h5>
                 <div class="system-badges">
                     <span class="status-badge status-{{ system.status }}">
                         {{ system.get_status_display }}
                     </span>
                 </div>
             </div>
             <p class="system-description">{{ system.description|truncatechars:100 }}</p>
             <div class="system-metrics-row">
                 <div class="metric-item">
                     <i class="fas fa-tasks text-muted"></i>
                     <span>{{ system.completion_percent }}% complete</span>
                 </div>
                 {% if system.repository_url %}
                     <div class="metric-item">
                         <i class="fab fa-github text-muted"></i>
                         <a href="{{ system.repository_url }}" target="_blank" class="repo-link">Repository</a>
                     </div>
                 {% endif %}
                 {% if system.live_url %}
                     <div class="metric-item">
                         <i class="fas fa-external-link-alt text-muted"></i>
                         <a href="{{ system.live_url }}" target="_blank" class="live-link">Live Demo</a>
                     </div>
                 {% endif %}
             </div>
         </div>
     </td>
     <td>
         <div class="system-type-display">
             <div class="type-icon" style="color: {{ system.system_type.color_hex }};">
                 <i class="{{ system.system_type.icon_class }}"></i>
             </div>
             <div class="type-info">
                 <div class="type-name">{{ system.system_type.name }}</div>
                 <div class="type-code">{{ system.system_type.slug|upper }}</div>
             </div>
         </div>
     </td>
     <td>
         <div class="performance-column">
             {% if system.performance_score %}
                 <div class="performance-metric">
                     <div class="metric-label">Performance</div>
                     <div class="metric-value">{{ system.performance_score }}%</div>
                     {{ system.performance_score|completion_bar }}
                 </div>
             {% endif %}
             {% if system.uptime_percentage %}
                 <div class="performance-metric">
                     <div class="metric-label">Uptime</div>
                     <div class="metric-value">{{ system.uptime_percentage }}%</div>
                     {{ system.uptime_percentage|completion_bar }}
                 </div>
             {% endif %}
             {% if not system.performance_score and not system.uptime_percentage %}
                 <div class="no-metrics">
                     <i class="fas fa-chart-line text-muted"></i>
                     <span class="text-muted">No metrics</span>
                 </div>
             {% endif %}
         </div>
     </td>
     <td>
         <div class="technologies-column">
             {% for tech in system.technologies.all|slice:":3" %}
                 <span class="tech-badge">{{ tech.name }}</span>
             {% endfor %}
             {% if system.technologies.count > 3 %}
                 <span class="tech-badge more" title="{% for tech in system.technologies.all|slice:'3:' %}{{ tech.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">
                     +{{ system.technologies.count|add:"-3" }}
                 </span>
             {% endif %}
         </div>
     </td>
     <td>
         <div class="priority-column">
             {{ system.priority|priority_badge }}
             {% if system.priority >= 3 %}
                 <div class="priority-indicator high-priority">
                     <i class="fas fa-exclamation-triangle"></i>
                 </div>
             {% endif %}
         </div>
     </td>
     <td>
         <div class="date-column">
             <div class="date-primary">{{ system.updated_at|date:"M d, Y" }}</div>
             <div class="date-secondary">{{ system.updated_at|time:"g:i A" }}</div>
             {% if system.deployment_date %}
                 <div class="deployment-date">
                     <i class="fas fa-rocket text-success"></i>
                     Deployed {{ system.deployment_date|timesince }} ago
                 </div>
             {% endif %}
         </div>
     </td>
     <td>
         <div class="action-buttons">
             <a href="{{ system.get_absolute_url }}" 
                target="_blank" 
                class="btn btn-sm btn-outline-primary" 
                title="View System">
                 <i class="fas fa-eye"></i>
             </a>
             <a href="{% url edit_url_name system.slug %}" 
                class="btn btn-sm btn-outline-secondary" 
                title="Edit System">
                 <i class="fas fa-edit"></i>
             </a>
             {% if system.status == 'published' %}
             <button type="button" 
             class="btn btn-sm btn-outline-success quick-deploy" 
             data-system-id="{{ system.id }}" 
             title="Quick Deploy">
         <i class="fas fa-rocket"></i>
     </button>
 {% endif %}
 <div class="dropdown">
     <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
             type="button" 
             data-bs-toggle="dropdown">
         <i class="fas fa-ellipsis-v"></i>
     </button>
     <ul class="dropdown-menu">
         <li>
             <a class="dropdown-item" href="{% url edit_url_name system.slug %}">
                 <i class="fas fa-edit me-2"></i>Edit System
             </a>
         </li>
         <li>
             <a class="dropdown-item" href="{{ system.get_absolute_url }}" target="_blank">
                 <i class="fas fa-eye me-2"></i>View System
             </a>
         </li>
         <li><hr class="dropdown-divider"></li>
         {% if system.featured %}
             <li>
                 <a class="dropdown-item toggle-feature" href="#" data-system-id="{{ system.id }}" data-action="unfeature">
                     <i class="fas fa-star-o me-2"></i>Remove Feature
                 </a>
             </li>
         {% else %}
             <li>
                 <a class="dropdown-item toggle-feature" href="#" data-system-id="{{ system.id }}" data-action="feature">
                     <i class="fas fa-star me-2"></i>Make Featured
                 </a>
             </li>
         {% endif %}
         <li>
             <a class="dropdown-item health-check-item" href="#" data-system-id="{{ system.id }}">
                 <i class="fas fa-heartbeat me-2"></i>Health Check
             </a>
         </li>
         {% if system.repository_url %}
             <li>
                 <a class="dropdown-item" href="{{ system.repository_url }}" target="_blank">
                     <i class="fab fa-github me-2"></i>View Repository
                 </a>
             </li>
         {% endif %}
         {% if system.live_url %}
             <li>
                 <a class="dropdown-item" href="{{ system.live_url }}" target="_blank">
                     <i class="fas fa-external-link-alt me-2"></i>Live Demo
                 </a>
             </li>
         {% endif %}
         <li><hr class="dropdown-divider"></li>
         <li>
             <a class="dropdown-item text-danger" href="{% url delete_url_name system.slug %}">
                 <i class="fas fa-trash me-2"></i>Delete System
             </a>
         </li>
     </ul>
 </div>
</div>
</td>
{% endblock %}

{% block admin_content %}
<!-- Grid View (Alternative Layout) -->
<div class="systems-grid-view" style="display: none;">
<div class="grid-container">
{% for system in object_list %}
 <div class="system-card glass-card" data-system-id="{{ system.id }}">
     <div class="card-header">
         <div class="card-status">
             <div class="status-indicator status-{{ system.status }}">
                 <div class="status-dot"></div>
             </div>
             <div class="health-indicator health-{{ system.health_status }}">
                 <i class="fas fa-circle"></i>
             </div>
         </div>
         <div class="card-actions">
             <div class="dropdown">
                 <button class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                         type="button" 
                         data-bs-toggle="dropdown">
                     <i class="fas fa-ellipsis-v"></i>
                 </button>
                 <ul class="dropdown-menu">
                     <li><a class="dropdown-item" href="{% url 'projects_admin:system_update' system.slug %}">Edit</a></li>
                     <li><a class="dropdown-item" href="{{ system.get_absolute_url }}" target="_blank">View</a></li>
                     <li><hr class="dropdown-divider"></li>
                     <li><a class="dropdown-item text-danger" href="{% url 'projects_admin:system_delete' system.slug %}">Delete</a></li>
                 </ul>
             </div>
         </div>
     </div>
     
     <div class="card-content">
         <h4 class="system-name">
             <a href="{{ system.get_absolute_url }}" target="_blank">{{ system.name }}</a>
             {% if system.featured %}
                 <i class="fas fa-star featured-star"></i>
             {% endif %}
         </h4>
         
         <div class="system-type">
             <i class="{{ system.system_type.icon_class }} me-2" style="color: {{ system.system_type.color_hex }};"></i>
             {{ system.system_type.name }}
         </div>
         
         <p class="system-description">{{ system.description|truncatechars:120 }}</p>
         
         <div class="system-technologies">
             {% for tech in system.technologies.all|slice:":4" %}
                 <span class="tech-badge">{{ tech.name }}</span>
             {% endfor %}
             {% if system.technologies.count > 4 %}
                 <span class="tech-badge more">+{{ system.technologies.count|add:"-4" }}</span>
             {% endif %}
         </div>
     </div>
     
     <div class="card-metrics">
         <div class="metric-row">
             <div class="metric-item">
                 <span class="metric-label">Completion</span>
                 <span class="metric-value">{{ system.completion_percent }}%</span>
             </div>
             {% if system.performance_score %}
                 <div class="metric-item">
                     <span class="metric-label">Performance</span>
                     <span class="metric-value">{{ system.performance_score }}%</span>
                 </div>
             {% endif %}
         </div>
         
         <div class="progress-row">
             <div class="progress-bar-container">
                 <div class="progress-bar" style="width: {{ system.completion_percent }}%;"></div>
             </div>
         </div>
     </div>
     
     <div class="card-footer">
         <div class="footer-info">
             <span class="status-badge status-{{ system.status }}">{{ system.get_status_display }}</span>
             {{ system.priority|priority_badge }}
         </div>
         <div class="footer-date">
             {{ system.updated_at|timesince }} ago
         </div>
     </div>
 </div>
{% empty %}
 <div class="empty-state-grid">
     <i class="fas fa-server fa-4x text-muted mb-3"></i>
     <h4>No systems found</h4>
     <p class="text-muted">Deploy your first system to get started with portfolio management.</p>
     <a href="{{ create_url }}" class="btn btn-primary">
         <i class="fas fa-plus me-2"></i>
         Deploy First System
     </a>
 </div>
{% endfor %}
</div>
</div>

{{ block.super }}
{% endblock %}

{% block admin_css %}
{{ block.super }}
<style>
.system-filters-bar {
background: rgba(255, 255, 255, 0.05);
padding: 1.5rem;
border-radius: 0.75rem;
margin-bottom: 1rem;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.filters-row {
display: flex;
gap: 1rem;
align-items: center;
flex-wrap: wrap;
}

.search-group {
display: flex;
flex: 1;
min-width: 300px;
}

.search-input {
border-top-right-radius: 0;
border-bottom-right-radius: 0;
border-right: none;
}

.search-btn,
.clear-btn {
border-top-left-radius: 0;
border-bottom-left-radius: 0;
}

.filter-group {
display: flex;
gap: 0.5rem;
flex-wrap: wrap;
}

.filter-select {
min-width: 130px;
background: rgba(255, 255, 255, 0.05);
border: 1px solid rgba(255, 255, 255, 0.2);
color: var(--text-primary);
}

.filter-select:focus {
background: rgba(255, 255, 255, 0.1);
border-color: var(--cyan);
box-shadow: 0 0 0 0.25rem rgba(var(--cyan-rgb), 0.25);
}

.view-controls {
margin-left: auto;
}

.view-btn {
padding: 0.5rem 0.75rem;
}

.view-btn.active {
background: var(--cyan);
color: white;
border-color: var(--cyan);
}

.system-status-column {
display: flex;
flex-direction: column;
align-items: center;
gap: 0.5rem;
}

.status-indicator {
width: 24px;
height: 24px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
position: relative;
}

.status-indicator.status-deployed {
background: rgba(var(--success-rgb), 0.2);
border: 2px solid var(--success);
}

.status-indicator.status-published {
background: rgba(var(--info-rgb), 0.2);
border: 2px solid var(--info);
}

.status-indicator.status-in_development {
background: rgba(var(--warning-rgb), 0.2);
border: 2px solid var(--warning);
}

.status-dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: currentColor;
animation: statusPulse 2s infinite;
}

@keyframes statusPulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}

.health-indicator {
font-size: 0.75rem;
padding: 0.25rem;
}

.health-indicator.health-healthy {
color: var(--success);
}

.health-indicator.health-warning {
color: var(--warning);
}

.health-indicator.health-critical {
color: var(--danger);
animation: healthBlink 1s infinite;
}

@keyframes healthBlink {
0%, 100% { opacity: 1; }
50% { opacity: 0.3; }
}

.system-details {
display: flex;
flex-direction: column;
gap: 0.75rem;
}

.system-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
gap: 1rem;
}

.system-name {
margin: 0;
font-size: 1.125rem;
font-weight: 600;
line-height: 1.3;
}

.system-link {
color: var(--text-primary);
text-decoration: none;
transition: color 0.3s ease;
}

.system-link:hover {
color: var(--cyan);
}

.featured-star {
color: var(--amber);
margin-left: 0.5rem;
font-size: 0.875rem;
}

.system-description {
margin: 0;
font-size: 0.875rem;
color: var(--text-secondary);
line-height: 1.4;
}

.system-metrics-row {
display: flex;
gap: 1rem;
flex-wrap: wrap;
}

.metric-item {
display: flex;
align-items: center;
gap: 0.375rem;
font-size: 0.75rem;
color: var(--text-secondary);
}

.metric-item i {
width: 12px;
text-align: center;
}

.repo-link,
.live-link {
color: var(--text-secondary);
text-decoration: none;
font-weight: 500;
transition: color 0.3s ease;
}

.repo-link:hover {
color: var(--purple);
}

.live-link:hover {
color: var(--cyan);
}

.system-type-display {
display: flex;
align-items: center;
gap: 0.75rem;
}

.type-icon {
width: 32px;
height: 32px;
border-radius: 50%;
background: rgba(255, 255, 255, 0.1);
display: flex;
align-items: center;
justify-content: center;
font-size: 0.875rem;
flex-shrink: 0;
}

.type-info {
display: flex;
flex-direction: column;
gap: 0.125rem;
}

.type-name {
font-weight: 500;
color: var(--text-primary);
font-size: 0.875rem;
line-height: 1.2;
}

.type-code {
font-size: 0.7rem;
color: var(--text-secondary);
font-family: 'Fira Code', monospace;
letter-spacing: 0.05em;
}

.performance-column {
display: flex;
flex-direction: column;
gap: 0.75rem;
}

.performance-metric {
display: flex;
flex-direction: column;
gap: 0.25rem;
}

.metric-label {
font-size: 0.75rem;
color: var(--text-secondary);
}

.metric-value {
font-size: 0.875rem;
font-weight: 600;
color: var(--text-primary);
}

.no-metrics {
display: flex;
flex-direction: column;
align-items: center;
gap: 0.25rem;
padding: 1rem 0;
text-align: center;
}

.technologies-column {
display: flex;
flex-direction: column;
gap: 0.25rem;
}

.tech-badge {
padding: 0.125rem 0.5rem;
background: rgba(var(--blue-rgb), 0.1);
color: var(--blue);
border: 1px solid rgba(var(--blue-rgb), 0.2);
border-radius: 0.75rem;
font-size: 0.7rem;
font-weight: 500;
text-align: center;
}

.tech-badge.more {
background: rgba(255, 255, 255, 0.05);
color: var(--text-secondary);
border-color: rgba(255, 255, 255, 0.1);
cursor: help;
}

.priority-column {
display: flex;
flex-direction: column;
align-items: center;
gap: 0.5rem;
}

.priority-indicator.high-priority {
color: var(--danger);
font-size: 0.875rem;
animation: priorityPulse 2s infinite;
}

@keyframes priorityPulse {
0%, 100% { opacity: 0.7; }
50% { opacity: 1; }
}

.date-column {
display: flex;
flex-direction: column;
gap: 0.125rem;
}

.date-primary {
font-weight: 500;
color: var(--text-primary);
font-size: 0.875rem;
}

.date-secondary {
font-size: 0.75rem;
color: var(--text-secondary);
}

.deployment-date {
font-size: 0.7rem;
color: var(--success);
display: flex;
align-items: center;
gap: 0.25rem;
margin-top: 0.25rem;
}

.quick-deploy {
background: rgba(var(--success-rgb), 0.1);
border-color: rgba(var(--success-rgb), 0.3);
color: var(--success);
}

.quick-deploy:hover {
background: rgba(var(--success-rgb), 0.2);
border-color: var(--success);
color: var(--success);
}

/* Grid View Styles */
.systems-grid-view {
padding: 2rem 0;
}

.grid-container {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
gap: 1.5rem;
}

.system-card {
padding: 1.5rem;
transition: all 0.3s ease;
border: 1px solid rgba(255, 255, 255, 0.1);
}

.system-card:hover {
transform: translateY(-5px);
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
border-color: rgba(var(--cyan-rgb), 0.3);
}

.card-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 1rem;
}

.card-status {
display: flex;
gap: 0.5rem;
align-items: center;
}

.card-content h4 {
margin-bottom: 0.5rem;
font-size: 1.25rem;
}

.card-content .system-type {
font-size: 0.875rem;
color: var(--text-secondary);
margin-bottom: 0.75rem;
}

.card-content .system-description {
margin-bottom: 1rem;
line-height: 1.5;
}

.card-content .system-technologies {
display: flex;
flex-wrap: wrap;
gap: 0.25rem;
margin-bottom: 1rem;
}

.card-metrics {
border-top: 1px solid rgba(255, 255, 255, 0.1);
padding-top: 1rem;
margin-bottom: 1rem;
}

.metric-row {
display: flex;
justify-content: space-between;
margin-bottom: 0.5rem;
}

.progress-row {
margin-bottom: 0.5rem;
}

.progress-bar-container {
height: 4px;
background: rgba(255, 255, 255, 0.1);
border-radius: 2px;
overflow: hidden;
}

.progress-bar {
height: 100%;
background: linear-gradient(90deg, var(--cyan) 0%, var(--blue) 100%);
border-radius: 2px;
transition: width 1s ease-out;
}

.card-footer {
display: flex;
justify-content: space-between;
align-items: center;
font-size: 0.875rem;
}

.footer-info {
display: flex;
gap: 0.5rem;
align-items: center;
}

.footer-date {
color: var(--text-secondary);
font-size: 0.75rem;
}

.empty-state-grid {
grid-column: 1 / -1;
text-align: center;
padding: 4rem 2rem;
background: rgba(255, 255, 255, 0.02);
border: 2px dashed rgba(255, 255, 255, 0.1);
border-radius: 1rem;
}

.empty-state-grid i {
color: var(--cyan);
opacity: 0.6;
}

/* Responsive design */
@media (max-width: 1200px) {
.grid-container {
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 1rem;
}
}

@media (max-width: 768px) {
.filters-row {
flex-direction: column;
align-items: stretch;
gap: 1rem;
}

.search-group {
min-width: auto;
}

.filter-group {
justify-content: stretch;
}

.filter-select {
flex: 1;
min-width: auto;
}

.view-controls {
margin-left: 0;
align-self: center;
}

.system-header {
flex-direction: column;
align-items: flex-start;
gap: 0.5rem;
}

.system-metrics-row {
flex-direction: column;
gap: 0.5rem;
}

.grid-container {
grid-template-columns: 1fr;
}

.metric-row {
flex-direction: column;
gap: 0.25rem;
}
}

/* Bulk actions enhancement */
.bulk-actions-bar {
background: linear-gradient(135deg, rgba(var(--cyan-rgb), 0.1) 0%, rgba(var(--blue-rgb), 0.1) 100%);
border-color: rgba(var(--cyan-rgb), 0.2);
}

.selected-count {
color: var(--cyan);
font-weight: 600;
}

/* Enhanced dropdown styling */
.dropdown-menu {
background: rgba(var(--bg-secondary), 0.95);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 0.5rem;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.dropdown-item {
color: var(--text-secondary);
padding: 0.5rem 1rem;
transition: all 0.3s ease;
}

.dropdown-item:hover {
background: rgba(255, 255, 255, 0.1);
color: var(--text-primary);
}

.dropdown-item.text-danger {
color: var(--danger);
}

.dropdown-item.text-danger:hover {
background: rgba(var(--danger-rgb), 0.1);
color: var(--danger);
}
</style>
{% endblock %}

{% block admin_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
console.log('🚀 Systems List Admin Initialized');

// View toggle functionality
initViewToggle();

// Quick deploy functionality
initQuickDeploy();

// Feature toggle functionality
initFeatureToggle();

// Health check functionality
initHealthCheck();

// Enhanced filtering
initAdvancedFiltering();

// Grid card interactions
initGridInteractions();
});

function initViewToggle() {
const viewButtons = document.querySelectorAll('.view-btn');
const tableView = document.querySelector('.admin-list-container');
const gridView = document.querySelector('.systems-grid-view');

viewButtons.forEach(btn => {
btn.addEventListener('click', function() {
 const view = this.dataset.view;
 
 // Update button states
 viewButtons.forEach(b => b.classList.remove('active'));
 this.classList.add('active');
 
 // Toggle views
 if (view === 'grid') {
     tableView.style.display = 'none';
     gridView.style.display = 'block';
     
     // Initialize grid animations
     setTimeout(initGridAnimations, 100);
 } else {
     tableView.style.display = 'block';
     gridView.style.display = 'none';
 }
 
 // Save preference
 localStorage.setItem('systems_view_preference', view);
});
});

// Load saved preference
const savedView = localStorage.getItem('systems_view_preference');
if (savedView) {
const savedBtn = document.querySelector(`[data-view="${savedView}"]`);
if (savedBtn) {
 savedBtn.click();
}
}
}

function initGridAnimations() {
const cards = document.querySelectorAll('.system-card');

cards.forEach((card, index) => {
card.style.opacity = '0';
card.style.transform = 'translateY(20px)';

setTimeout(() => {
 card.style.transition = 'all 0.5s ease';
 card.style.opacity = '1';
 card.style.transform = 'translateY(0)';
}, index * 100);
});
}

function initQuickDeploy() {
document.querySelectorAll('.quick-deploy').forEach(button => {
button.addEventListener('click', function() {
 const systemId = this.dataset.systemId;
 const originalContent = this.innerHTML;
 
 this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
 this.disabled = true;
 
 fetch(`/aura-admin/projects/systems/${systemId}/quick-deploy/`, {
     method: 'POST',
     headers: {
         'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
         'Content-Type': 'application/json',
     },
     body: JSON.stringify({ action: 'deploy' })
 })
 .then(response => response.json())
 .then(data => {
     if (data.success) {
         // Update the row to show deployed status
         const row = this.closest('tr') || this.closest('.system-card');
         updateSystemStatus(row, 'deployed');
         
         // Remove the quick deploy button
         this.remove();
         
         if (window.auraAdmin) {
             window.auraAdmin.showNotification('System deployed successfully!', 'success');
         }
     } else {
         this.innerHTML = originalContent;
         this.disabled = false;
         
         if (window.auraAdmin) {
             window.auraAdmin.showNotification('Failed to deploy system.', 'error');
         }
     }
 })
 .catch(error => {
     this.innerHTML = originalContent;
     this.disabled = false;
     console.error('Deploy error:', error);
     
     if (window.auraAdmin) {
         window.auraAdmin.showNotification('Deployment error occurred.', 'error');
     }
 });
});
});
}

function initFeatureToggle() {
document.querySelectorAll('.toggle-feature').forEach(link => {
link.addEventListener('click', function(e) {
 e.preventDefault();
 
 const systemId = this.dataset.systemId;
 const action = this.dataset.action;
 const row = this.closest('tr') || this.closest('.system-card');
 
 fetch(`/aura-admin/projects/systems/${systemId}/toggle-feature/`, {
     method: 'POST',
     headers: {
         'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
         'Content-Type': 'application/json',
     },
     body: JSON.stringify({ action: action })
 })
 .then(response => response.json())
 .then(data => {
     if (data.success) {
         const nameElements = row.querySelectorAll('.system-name');
         nameElements.forEach(nameElement => {
             const existingStar = nameElement.querySelector('.featured-star');
             
             if (action === 'feature') {
                 if (!existingStar) {
                     nameElement.insertAdjacentHTML('beforeend', '<i class="fas fa-star featured-star" title="Featured System"></i>');
                 }
                 this.innerHTML = '<i class="fas fa-star-o me-2"></i>Remove Feature';
                 this.dataset.action = 'unfeature';
             } else {
                 if (existingStar) {
                     existingStar.remove();
                 }
                 this.innerHTML = '<i class="fas fa-star me-2"></i>Make Featured';
                 this.dataset.action = 'feature';
             }
         });
         
         if (window.auraAdmin) {
             window.auraAdmin.showNotification(data.message, 'success');
         }
     }
 })
 .catch(error => {
     console.error('Feature toggle error:', error);
     if (window.auraAdmin) {
         window.auraAdmin.showNotification('An error occurred.', 'error');
     }
 });
});
});
}

function initHealthCheck() {
document.querySelectorAll('.health-check-item').forEach(link => {
link.addEventListener('click', function(e) {
 e.preventDefault();
 
 const systemId = this.dataset.systemId;
 const originalText = this.innerHTML;
 
 this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Checking...';
 
 fetch(`/aura-admin/projects/api/health-check/`, {
     method: 'POST',
     headers: {
         'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
         'Content-Type': 'application/json',
     },
     body: JSON.stringify({ 
         action: 'health_check',
         system_ids: [systemId]
     })
 })
 .then(response => response.json())
 .then(data => {
     if (data.success) {
         // Update health indicator
         const row = this.closest('tr') || this.closest('.system-card');
         const healthIndicator = row.querySelector('.health-indicator');
         if (healthIndicator && data.health_status) {
             healthIndicator.className = `health-indicator health-${data.health_status}`;
         }
         
         if (window.auraAdmin) {
             window.auraAdmin.showNotification(
                 `Health check complete. Status: ${data.health_status}`, 
                 data.health_status === 'healthy' ? 'success' : 'warning'
             );
         }
     } else {
         if (window.auraAdmin) {
             window.auraAdmin.showNotification('Health check failed.', 'error');
         }
     }
 })
 .catch(error => {
     console.error('Health check error:', error);
     if (window.auraAdmin) {
         window.auraAdmin.showNotification('Health check error.', 'error');
     }
 })
 .finally(() => {
     setTimeout(() => {
         this.innerHTML = originalText;
     }, 1000);
 });
});
});
}

function initAdvancedFiltering() {
// Real-time search with debouncing
let searchTimeout;
const searchInput = document.querySelector('.search-input');

if (searchInput) {
searchInput.addEventListener('input', function() {
 clearTimeout(searchTimeout);
 searchTimeout = setTimeout(() => {
     if (this.value.length >= 3 || this.value.length === 0) {
         performLiveSearch(this.value);
     }
 }, 500);
});
}

// Filter combination tracking
const filterSelects = document.querySelectorAll('.filter-select');
filterSelects.forEach(select => {
select.addEventListener('change', function() {
 // Add loading state
 this.style.opacity = '0.6';
 this.disabled = true;
 
 // Add visual feedback
 const activeFilters = Array.from(filterSelects)
     .filter(s => s.value)
     .length;
     
 if (activeFilters > 0) {
     updateFilterIndicator(activeFilters);
 }
 
 setTimeout(() => {
     this.style.opacity = '';
     this.disabled = false;
 }, 1000);
});
});
}

function performLiveSearch(query) {
if (!query.trim()) return;

// Visual feedback for search
const searchBtn = document.querySelector('.search-btn');
if (searchBtn) {
searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

setTimeout(() => {
 searchBtn.innerHTML = '<i class="fas fa-search"></i>';
}, 1000);
}

// Here you would typically make an AJAX call for live results
console.log('Performing live search for:', query);
}

function updateFilterIndicator(count) {
// Add/update filter indicator
let indicator = document.querySelector('.filter-indicator');
if (!indicator) {
indicator = document.createElement('div');
indicator.className = 'filter-indicator';
indicator.style.cssText = `
 position: absolute;
 top: -8px;
 right: -8px;
 background: var(--cyan);
 color: white;
 border-radius: 50%;
 width: 20px;
 height: 20px;
 font-size: 0.75rem;
 display: flex;
 align-items: center;
 justify-content: center;
 font-weight: 600;
`;

const filterGroup = document.querySelector('.filter-group');
if (filterGroup) {
 filterGroup.style.position = 'relative';
 filterGroup.appendChild(indicator);
}
}

indicator.textContent = count;

if (count === 0) {
indicator.remove();
}
}

function initGridInteractions() {
// Enhanced grid card interactions
const systemCards = document.querySelectorAll('.system-card');

systemCards.forEach(card => {
// Add hover effects
card.addEventListener('mouseenter', function() {
 this.style.transform = 'translateY(-8px) scale(1.02)';
 this.style.boxShadow = '0 15px 40px rgba(0, 0, 0, 0.3)';
});

card.addEventListener('mouseleave', function() {
 this.style.transform = 'translateY(0) scale(1)';
 this.style.boxShadow = '';
});

// Double-click to edit
card.addEventListener('dblclick', function() {
 const editLink = this.querySelector('a[href*="update"]');
 if (editLink) {
     window.location.href = editLink.href;
 }
});

// Context menu
card.addEventListener('contextmenu', function(e) {
 e.preventDefault();
 showSystemContextMenu(e, this);
});
});
}

function updateSystemStatus(element, newStatus) {
// Update status indicators
const statusIndicator = element.querySelector('.status-indicator');
const statusBadge = element.querySelector('.status-badge');

if (statusIndicator) {
statusIndicator.className = `status-indicator status-${newStatus}`;
}

if (statusBadge) {
statusBadge.className = `status-badge status-${newStatus}`;
statusBadge.textContent = newStatus.charAt(0).toUpperCase() + newStatus.slice(1).replace('_', ' ');
}

// Add success animation
element.style.transition = 'all 0.5s ease';
element.style.background = 'rgba(var(--success-rgb), 0.1)';

setTimeout(() => {
element.style.background = '';
}, 2000);
}

function showSystemContextMenu(event, systemElement) {
// Remove existing context menu
const existingMenu = document.querySelector('.system-context-menu');
if (existingMenu) {
existingMenu.remove();
}

const menu = document.createElement('div');
menu.className = 'system-context-menu';
menu.style.cssText = `
position: fixed;
top: ${event.clientY}px;
left: ${event.clientX}px;
background: rgba(var(--bg-secondary), 0.95);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
border-radius: 0.5rem;
padding: 0.5rem;
z-index: 9999;
min-width: 180px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
`;

const systemId = systemElement.dataset.systemId;
const editLink = systemElement.querySelector('a[href*="update"]');
const viewLink = systemElement.querySelector('a[href*="system"]');

menu.innerHTML = `
<div class="context-menu-item" onclick="window.location.href='${editLink?.href}'">
 <i class="fas fa-edit me-2"></i>Edit System
</div>
<div class="context-menu-item" onclick="window.open('${viewLink?.href}', '_blank')">
 <i class="fas fa-eye me-2"></i>View System
</div>
<div class="context-menu-divider"></div>
<div class="context-menu-item" onclick="quickDeploySystem('${systemId}')">
 <i class="fas fa-rocket me-2"></i>Quick Deploy
</div>
<div class="context-menu-item" onclick="runSystemHealthCheck('${systemId}')">
 <i class="fas fa-heartbeat me-2"></i>Health Check
</div>
<div class="context-menu-divider"></div>
<div class="context-menu-item" onclick="duplicateSystem('${systemId}')">
 <i class="fas fa-copy me-2"></i>Duplicate System
</div>
`;

// Add context menu styles
const style = document.createElement('style');
style.textContent = `
.context-menu-item {
 padding: 0.5rem 0.75rem;
 cursor: pointer;
 transition: all 0.3s ease;
 color: var(--text-secondary);
 font-size: 0.875rem;
 border-radius: 0.25rem;
 display: flex;
 align-items: center;
}
.context-menu-item:hover {
 background: rgba(255, 255, 255, 0.1);
 color: var(--text-primary);
}
.context-menu-divider {
 height: 1px;
 background: rgba(255, 255, 255, 0.1);
 margin: 0.25rem 0;
}
`;
document.head.appendChild(style);

document.body.appendChild(menu);

// Remove menu on click outside
document.addEventListener('click', function removeMenu() {
menu.remove();
style.remove();
document.removeEventListener('click', removeMenu);
});
}

// Context menu actions
function quickDeploySystem(systemId) {
const deployBtn = document.querySelector(`[data-system-id="${systemId}"].quick-deploy`);
if (deployBtn) {
deployBtn.click();
} else {
console.log('Quick deploy system:', systemId);
// Implement direct deployment logic here
}
}

function runSystemHealthCheck(systemId) {
const healthBtn = document.querySelector(`[data-system-id="${systemId}"].health-check-item`);
if (healthBtn) {
healthBtn.click();
} else {
console.log('Health check system:', systemId);
// Implement direct health check logic here
}
}

function duplicateSystem(systemId) {
if (confirm('Create a duplicate of this system?')) {
fetch(`/aura-admin/projects/systems/${systemId}/duplicate/`, {
 method: 'POST',
 headers: {
     'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
     'Content-Type': 'application/json',
 }
})
.then(response => response.json())
.then(data => {
 if (data.success) {
     if (window.auraAdmin) {
         window.auraAdmin.showNotification('System duplicated successfully!', 'success');
     }
     // Refresh the page to show the new system
     setTimeout(() => window.location.reload(), 1000);
 } else {
     if (window.auraAdmin) {
         window.auraAdmin.showNotification('Failed to duplicate system.', 'error');
     }
 }
})
.catch(error => {
 console.error('Duplicate error:', error);
 if (window.auraAdmin) {
     window.auraAdmin.showNotification('Duplication error occurred.', 'error');
 }
});
}
}

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
// Ctrl/Cmd + K to focus search
if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
e.preventDefault();
const searchInput = document.querySelector('.search-input');
if (searchInput) {
 searchInput.focus();
 searchInput.select();
}
}

// Ctrl/Cmd + G to toggle grid view
if ((e.ctrlKey || e.metaKey) && e.key === 'g') {
e.preventDefault();
const gridBtn = document.querySelector('[data-view="grid"]');
if (gridBtn) {
 gridBtn.click();
}
}

// Ctrl/Cmd + T to toggle table view
if ((e.ctrlKey || e.metaKey) && e.key === 't') {
e.preventDefault();
const tableBtn = document.querySelector('[data-view="table"]');
if (tableBtn) {
 tableBtn.click();
}
}

// Ctrl/Cmd + N for new system
if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
e.preventDefault();
const createLink = document.querySelector('a[href*="create"]');
if (createLink) {
 window.location.href = createLink.href;
}
}
});

// Enhanced table interactions
document.querySelectorAll('.table-row').forEach(row => {
// Add click-to-select functionality
row.addEventListener('click', function(e) {
// Don't trigger on action buttons
if (e.target.closest('.action-buttons') || e.target.closest('.dropdown')) {
 return;
}

const checkbox = this.querySelector('.row-select');
if (checkbox) {
 checkbox.checked = !checkbox.checked;
 checkbox.dispatchEvent(new Event('change'));
}
});

// Enhanced hover effects
row.addEventListener('mouseenter', function() {
this.style.background = 'rgba(var(--cyan-rgb), 0.05)';
this.style.borderColor = 'rgba(var(--cyan-rgb), 0.2)';
});

row.addEventListener('mouseleave', function() {
if (!this.classList.contains('selected')) {
 this.style.background = '';
 this.style.borderColor = '';
}
});
});

// Auto-refresh functionality for real-time updates
let autoRefreshInterval;

function startAutoRefresh() {
autoRefreshInterval = setInterval(() => {
// Only refresh if page is visible
if (!document.hidden) {
 refreshSystemData();
}
}, 30000); // Refresh every 30 seconds
}

function stopAutoRefresh() {
if (autoRefreshInterval) {
clearInterval(autoRefreshInterval);
}
}

function refreshSystemData() {
// Subtle indicator that data is being refreshed
const indicator = document.createElement('div');
indicator.className = 'refresh-indicator';
indicator.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i>';
indicator.style.cssText = `
position: fixed;
top: 20px;
right: 80px;
background: rgba(var(--cyan-rgb), 0.2);
color: var(--cyan);
padding: 0.5rem;
border-radius: 50%;
z-index: 9999;
font-size: 0.875rem;
`;

document.body.appendChild(indicator);

// Fetch updated system data
fetch(window.location.href, {
headers: {
 'X-Requested-With': 'XMLHttpRequest',
}
})
.then(response => response.text())
.then(html => {
// Parse response and update system statuses
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');

// Update health indicators and metrics
updateSystemHealthFromResponse(doc);

setTimeout(() => {
 indicator.remove();
}, 1000);
})
.catch(error => {
console.error('Auto-refresh error:', error);
indicator.remove();
});
}

function updateSystemHealthFromResponse(doc) {
// Update health indicators based on fresh data
const currentHealthIndicators = document.querySelectorAll('.health-indicator');
const newHealthIndicators = doc.querySelectorAll('.health-indicator');

currentHealthIndicators.forEach((indicator, index) => {
if (newHealthIndicators[index]) {
 const newClass = newHealthIndicators[index].className;
 if (indicator.className !== newClass) {
     indicator.className = newClass;
     
     // Add update animation
     indicator.style.animation = 'healthUpdate 0.5s ease';
     setTimeout(() => {
         indicator.style.animation = '';
     }, 500);
 }
}
});
}

// Page visibility handling for auto-refresh
document.addEventListener('visibilitychange', function() {
if (document.hidden) {
stopAutoRefresh();
} else {
startAutoRefresh();
}
});

// Start auto-refresh when page loads
startAutoRefresh();

console.log('✅ Systems List Admin Ready - Grid/Table views, real-time updates, enhanced interactions');
</script>
{% endblock %}