<!-- projects/templates/projects/admin/system_form.html -->
{% extends 'admin/forms/create_base.html' %}
{% load static %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'projects/css/system-admin.css' %}">
{% endblock %}

{% block form_navigation %}
{% if object %}
    <nav class="form-nav system-nav">
        <a href="{{ object.get_absolute_url }}" class="nav-btn view-btn">
            <i class="fas fa-cog"></i> System Interface
        </a>
        <a href="{% url 'projects:system_delete' object.slug %}" class="nav-btn delete-btn">
            <i class="fas fa-trash"></i> Delete
        </a>
        <div class="nav-status">
            <span class="status-badge {{ object.status|lower }}">
                {{ object.get_status_display }}
            </span>
            <div class="system-health">
                <span class="health-indicator {{ object.health_status|lower }}"></span>
                {{ object.get_health_status_display }}
            </div>
        </div>
    </nav>
{% endif %}
{% endblock %}

{% block additional_fields %}
<div class="system-core-section">
    <h3 class="section-title">
        <i class="fas fa-microchip"></i>
        Core System Configuration
    </h3>
    
    <div class="core-grid">
        <div class="core-field">
            <label class="field-label">System Type</label>
            {{ form.system_type }}
        </div>
        
        <div class="core-field">
            <label class="field-label">Development Status</label>
            <div class="status-wrapper">
                {{ form.status }}
                <div class="status-help">
                    <i class="fas fa-info-circle"></i>
                    Current development phase
                </div>
            </div>
        </div>
        
        <div class="core-field">
            <label class="field-label">Priority Level</label>
            {{ form.priority }}
        </div>
        
        <div class="core-field">
            <label class="field-label">Complexity Rating</label>
            <div class="complexity-wrapper">
                {{ form.complexity }}
                <div class="complexity-scale">
                    <span data-level="1">Basic</span>
                    <span data-level="2">Intermediate</span>
                    <span data-level="3">Advanced</span>
                    <span data-level="4">Expert</span>
                    <span data-level="5">Cutting-edge</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="technology-section">
    <h3 class="section-title">
        <i class="fas fa-code-branch"></i>
        Technology Stack
    </h3>
    
    <div class="tech-fields">
        <div class="field-group">
            <label class="field-label">Primary Technologies</label>
            <div class="tech-selector">
                {{ form.technologies }}
                <div class="tech-help">
                    <i class="fas fa-lightbulb"></i>
                    Select all technologies used in this system
                </div>
            </div>
        </div>
        
        <div class="field-group">
            <label class="field-label">Tech Stack Details</label>
            <div class="stack-editor">
                {{ form.tech_stack }}
                <div class="editor-tools">
                    <button type="button" class="tool-btn" data-action="add-tech">
                        <i class="fas fa-plus"></i> Add Technology
                    </button>
                    <button type="button" class="tool-btn" data-action="import-stack">
                        <i class="fas fa-download"></i> Import from GitHub
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="metrics-section">
    <h3 class="section-title">
        <i class="fas fa-chart-line"></i>
        Performance Metrics
    </h3>
    
    <div class="metrics-grid">
        <div class="metric-field">
            <label class="field-label">Performance Score</label>
            <div class="score-input">
                {{ form.performance_score }}
                <div class="score-scale">
                    <span class="scale-marker" data-score="0">0</span>
                    <span class="scale-marker" data-score="25">25</span>
                    <span class="scale-marker" data-score="50">50</span>
                    <span class="scale-marker" data-score="75">75</span>
                    <span class="scale-marker" data-score="100">100</span>
                </div>
            </div>
        </div>
        
        <div class="metric-field">
            <label class="field-label">Code Quality</label>
            {{ form.code_quality_score }}
        </div>
        
        <div class="metric-field">
            <label class="field-label">Test Coverage</label>
            <div class="coverage-input">
                {{ form.test_coverage }}
                <span class="unit">%</span>
            </div>
        </div>
        
        <div class="metric-field">
            <label class="field-label">Documentation Score</label>
            {{ form.documentation_score }}
        </div>
    </div>
</div>

<div class="repository-section">
    <h3 class="section-title">
        <i class="fab fa-github"></i>
        Repository & Deployment
    </h3>
    
    <div class="repo-fields">
        <div class="field-group">
            <label class="field-label">GitHub Repository</label>
            <div class="repo-input">
                {{ form.github_repo }}
                <button type="button" class="repo-btn" data-action="validate">
                    <i class="fas fa-check"></i> Validate
                </button>
            </div>
        </div>
        
        <div class="field-group">
            <label class="field-label">Live Demo URL</label>
            {{ form.demo_url }}
        </div>
        
        <div class="field-group">
            <label class="field-label">Deployment Status</label>
            <div class="deployment-wrapper">
                {{ form.deployment_status }}
                <div class="deployment-indicator">
                    <span class="indicator-dot"></span>
                    <span class="indicator-text">Status will update automatically</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="challenges-section">
    <h3 class="section-title">
        <i class="fas fa-exclamation-triangle"></i>
        Challenges & Solutions
    </h3>
    
    <div class="challenges-fields">
        <div class="field-group">
            <label class="field-label">Technical Challenges</label>
            <div class="challenges-editor">
                {{ form.challenges }}
                <div class="challenges-help">
                    <i class="fas fa-info-circle"></i>
                    Document key technical challenges faced during development
                </div>
            </div>
        </div>
        
        <div class="field-group">
            <label class="field-label">Learning Outcomes</label>
            {{ form.learning_outcomes }}
        </div>
        
        <div class="field-group">
            <label class="field-label">Future Improvements</label>
            {{ form.future_improvements }}
        </div>
    </div>
</div>

<div class="visibility-section">
    <h3 class="section-title">
        <i class="fas fa-eye"></i>
        Display & Visibility
    </h3>
    
    <div class="visibility-grid">
        <div class="visibility-field">
            {{ form.is_featured }}
            <label for="{{ form.is_featured.id_for_label }}" class="option-label">
                <i class="fas fa-star"></i>
                Featured System
            </label>
        </div>
        
        <div class="visibility-field">
            {{ form.show_on_homepage }}
            <label for="{{ form.show_on_homepage.id_for_label }}" class="option-label">
                <i class="fas fa-home"></i>
                Show on Homepage
            </label>
        </div>
        
        <div class="visibility-field">
            {{ form.is_public }}
            <label for="{{ form.is_public.id_for_label }}" class="option-label">
                <i class="fas fa-globe"></i>
                Public System
            </label>
        </div>
        
        <div class="visibility-field">
            {{ form.include_in_portfolio }}
            <label for="{{ form.include_in_portfolio.id_for_label }}" class="option-label">
                <i class="fas fa-briefcase"></i>
                Include in Portfolio
            </label>
        </div>
    </div>
</div>
{% endblock %}

{% block form_sidebar %}
<div class="form-sidebar">
    <div class="sidebar-widget glass-card">
        <h4 class="widget-title">
            <i class="fas fa-info-circle"></i>
            System Health
        </h4>
        {% if object %}
            <div class="health-overview">
                <div class="health-metric">
                    <span class="metric-label">Overall Health</span>
                    <div class="health-bar">
                        <div class="health-fill" style="width: {{ object.health_percentage }}%"></div>
                    </div>
                    <span class="metric-value">{{ object.health_percentage }}%</span>
                </div>
                
                <div class="health-details">
                    <div class="detail-item">
                        <i class="fas fa-code"></i>
                        <span>Code Quality: {{ object.code_quality_score }}/100</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Test Coverage: {{ object.test_coverage }}%</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-book"></i>
                        <span>Documentation: {{ object.documentation_score }}/100</span>
                    </div>
                </div>
            </div>
        {% else %}
            <p class="widget-help">Health metrics will be calculated after saving</p>
        {% endif %}
    </div>
    
    <div class="sidebar-widget glass-card">
        <h4 class="widget-title">
            <i class="fas fa-link"></i>
            Related DataLogs
        </h4>
        {% if object.related_posts.exists %}
            <div class="related-posts">
                {% for post in object.related_posts.all|slice:":5" %}
                    <div class="related-item">
                        <a href="{% url 'blog:post_update' post.slug %}">{{ post.title }}</a>
                        <span class="post-date">{{ post.created_at|date:"M d" }}</span>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="widget-help">No related DataLogs yet</p>
            <a href="{% url 'blog:post_create' %}" class="btn btn-sm btn-outline">
                Create DataLog
            </a>
        {% endif %}
    </div>
    
    <div class="sidebar-widget glass-card">
        <h4 class="widget-title">
            <i class="fas fa-tools"></i>
            System Tools
        </h4>
        <div class="system-tools">
            {% if object.github_repo %}
                <a href="{{ object.github_repo }}" class="tool-btn" target="_blank">
                    <i class="fab fa-github"></i> Repository
                </a>
            {% endif %}
            {% if object.demo_url %}
                <a href="{{ object.demo_url }}" class="tool-btn" target="_blank">
                    <i class="fas fa-external-link-alt"></i> Live Demo
                </a>
            {% endif %}
            <button type="button" class="tool-btn" data-action="generate-docs">
                <i class="fas fa-file-alt"></i> Generate Docs
            </button>
            <button type="button" class="tool-btn" data-action="run-tests">
                <i class="fas fa-vial"></i> Run Tests
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block admin_js %}
<script src="{% static 'projects/js/system-admin.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize technology selector
        initializeTechnologySelector();
        
        // Initialize performance metrics
        initializeMetricsSliders();
        
        // Initialize repository validation
        initializeRepoValidation();
        
        // Auto-calculate health score
        calculateHealthScore();
    });
</script>
{% endblock %}